

----QUIT----(13 November 2021 20:18:32) CuisUniversity-4972.image priorSource: 14896235!

----STARTUP---- (13 November 2021 20:18:33) as /Users/hernan/Documents/Cuis/5.0-64Bits/Cuis-University-Installer/CuisUniversity-4972.image!


----QUIT----(13 November 2021 20:18:33) CuisUniversity-4972.image priorSource: 18974023!

----STARTUP---- (14 November 2021 16:45:17) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!


----End fileIn of C:\Users\maxi\Downloads\TusLibros-Tests.st----!

----End fileIn of C:\Users\maxi\Downloads\TusLibros-Model.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:00'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/14/2021 16:48:02'!
PASSED!

!classRemoval: #TusLibrosInterfaceTest stamp: 'MF 11/14/2021 16:50:15'!
TestCase subclass: #TusLibrosInterfaceTest
	instanceVariableNames: 'webServer port systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Features\Compression.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Features\Sound.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\System\Network-Kernel.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\WebClient.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\StringsServicesServer.st----!

server := TusLibrosInterface listeningOn: 8080 interactingWith: self
!


server destroy.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 16:57:24'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !

server destroy.!

server destroy.!

StringsServicesRestInterface allInstances!

StringsServicesRestInterface allInstances!

StringsServicesRestInterface allInstances!

TusLibrosInterface allInstances.!

TusLibrosInterface allInstances.!

(self at: 1) destroy!

(self at: 1) destroy!

(self at: 1) destroy!

(self at: 1) destroy!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:09:17' prior: 50926011!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/helloworld' action:[:request |	
		
		[request send200Response: (self helloWorld).] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/createCart' action: [ :request | | clientId password cartId cartIdAsJson |
		[ clientId _ request fields at: 'clientId'.
		password _ request fields at: 'password'.
		cartId _ systemFacade createCartFor: clientId authenticatedWith: password.
		cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
		request send200Response: cartIdAsJson.]
		on: Error
		do: [ :anError |
			request send400Response: (anError messageText) ]].
		
		
		
		
		
		
		
		
		! !

Object subclass: #InterfaceTestObjectsFactory
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #InterfaceTestObjectsFactory category: #'TusLibros-Tests' stamp: 'MF 11/14/2021 17:11:18'!
Object subclass: #InterfaceTestObjectsFactory
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!InterfaceTestObjectsFactory methodsFor: 'no messages' stamp: 'MF 11/14/2021 17:12:05'!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:12:14'!
validUserPassword

	^'validUserPassword'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:12:18'!
validUser

	^'validUser'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:12:37'!
validBook

	^self itemSellByTheStore.! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:12:57'!
merchantProcessor

	^self! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:00'!
debit: anAmount from: aCreditCard
! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:11'!
invalidBook

	^self itemNotSellByTheStore ! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:20'!
invalidCartId

	^nil! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:24'!
invalidPassword

	^'invalidPassword'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:27'!
invalidUser

	^'invalidUser'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:13:35'!
createSalesBook

	^OrderedCollection new! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:00'!
anotherValidBook

	^self anotherItemSellByTheStore ! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:13'!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:19'!
itemSellByTheStore

	^ 'validBook'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:23'!
itemSellByTheStorePrice

	^10! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:27'!
itemNotSellByTheStore

	^'invalidBook'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:40'!
anotherItemSellByTheStore

	^'anotherValidBook'! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:14:43'!
anotherItemSellByTheStorePrice

	^15! !
!InterfaceTestObjectsFactory methodsFor: 'nil' stamp: 'MF 11/14/2021 17:17:18'!
createSystemFacade

	^TusLibrosSystemFacade authenticatingWith: self validUsersAndPasswords 
			 acceptingItemsOf:  self defaultCatalog 
			 registeringOn: self createSalesBook 
			 debitingThrought: self 
			 measuringTimeWith: self clock.! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:18:22'!
clock

	^ManualClock now: DateAndTime now.! !

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.

!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.!


server destroy!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:25:31'!
addService: anEndpoint action: anActionBlock

	webServer 
		addService: anEndpoint 
		action: [ :request |
			[anActionBlock value: request] 
			on: Error
			do: [ :anError |
				request send400Response: anError messageText.]]! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:37:37' prior: 50963573!
addService: anEndpoint action: anActionBlock

	webServer 
		addService: anEndpoint 
		action: [ :request |
			[ anActionBlock value: request ] 
			on: Error
			do: [ :anError |
				request send400Response: anError messageText.]]! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:43:42'!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ systemFacade createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:44:58' prior: 50963416!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/helloworld' action:[:request |	
		
		[request send200Response: (self helloWorld).] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
		
		
		
		
		
		
		
		
		! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:45:21' prior: 50963608!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].! !

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.
!

server destroy!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:46:08' prior: 50963627!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'MF 11/14/2021 17:48:42'!
test20ListCatalogReturnsCatalog

	! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'MF 11/14/2021 17:50:33'!
defaultCatalog

	^testObjectsFactory defaultCatalog ! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'MF 11/14/2021 17:50:41' prior: 50925061 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - catalogue' stamp: 'MF 11/14/2021 17:50:59' prior: 50963659!
test20ListCatalogReturnsCatalog

	self assert: (self defaultCatalog) equals: (systemFacade listCatalog).! !

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/14/2021 17:51:00'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:51:11'!
listCatalog
	self shouldBeImplemented.! !
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:51:28' prior: 50963694!
listCatalog
	
	^ catalog copy.! !

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/14/2021 17:51:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/14/2021 17:51:30'!
PASSED!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:53:27'!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ systemFacade listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.
!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:56:13' prior: 50963645!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:58:51'!
addToCart: aRequest

	
	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity of: bookISBN toCartIdentifiedAs: cartId.
	aRequest send200Response: 'OK'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:58:59' prior: 50963812!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity of: bookISBN toCartIdentifiedAs: cartId.
	aRequest send200Response: 'OK'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 17:59:43' prior: 50963796!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self addToCart: request ].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:00:37'!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId.
	contentsAsJson _ WebUtils jsonEncode: cartContents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:01:15' prior: 50963838!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self addToCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:06:18'!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self addToCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	! !
!TusLibrosInterface class methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:06:18' prior: 50926044!
listeningOn: aPortNumber interactingWith: aTusLibrosSystemFacade

	^self new initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade.! !

!methodRemoval: TusLibrosInterface #initializeWith:with: stamp: 'MF 11/14/2021 18:06:18'!
initializeWith: aPortNumber with: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self addToCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:21:52'!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'me'.
	yearExpiration _ aRequest fields at: 'ye'.
	creditCardOwner _ aRequest fields at: 'co'.
	
	! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/14/2021 18:21:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:21:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/14/2021 18:21:59'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'MF 11/14/2021 18:22:01' prior: 50926183!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/14/2021 18:22:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/14/2021 18:22:02'!
PASSED!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:28:26' prior: 50963943!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'me'.
	yearExpiration _ aRequest fields at: 'ye'.
	creditCardOwner _ aRequest fields at: 'co'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (Month month: monthExpiration year: yearExpiration).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:30:18'!
serializeTicket: aTicket

	| xxx |
	xxx _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | xxx at: aLineItem item put: aLineItem total ].
	xxx at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: xxx.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:31:44' prior: 50964145!
serializeTicket: aTicket

	| ticketDictionary |
	ticketDictionary _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | ticketDictionary at: aLineItem item put: aLineItem total ].
	ticketDictionary at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: ticketDictionary.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:32:34' prior: 50963891!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self addToCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 18:34:56'!
listPurchases: aRequest

	| cartId cartIdAsJson clientId password purchases |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.! !

----SNAPSHOT----(14 November 2021 18:38:32) CuisUniversity-4972.image priorSource: 18974255!

----STARTUP---- (14 November 2021 18:41:29) as E:\Cursada Actual IS1\!!Ejercicio actual\20-TusLibros\Iteracion4\CuisUniversity-4972.image!

!StoreTestObjectsFactory methodsFor: 'initialization' stamp: 'LNB 11/14/2021 18:53:24' prior: 50925446 overrides: 16896425!
initialize

	today := GregorianDateTime now! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 18:54:53' prior: 50925439!
notExpiredMonthOfYear

	^ GregorianMonthOfYear year: today year month: today month. "Month month: today monthIndex year: today yearNumber + "! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 18:54:58' prior: 50964217!
notExpiredMonthOfYear

	^ GregorianMonthOfYear year: today year month: today month.! !

((0-2*month) convertTo: TimeUnits month)!

-2 !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:05:50' prior: 50925417!
expiredMonthOfYear

	^ (today next: -1*month) monthOfYear.! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:06:05' prior: 50964225!
notExpiredMonthOfYear

	^ today monthOfYear.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 19:06:07'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 19:06:07'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:06:08'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:06:08'!
ERROR!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:06:08'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:06:08'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:06:08'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:06:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:06:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:06:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:06:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:06:09'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:06:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:06:10'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:06:10'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:06:10'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:06:10'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:06:10'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:06:10'!
PASSED!
!CreditCard class methodsFor: 'instance creation' stamp: 'LNB 11/14/2021 19:09:33' prior: 50925842!
expiringOn: aMonthOfYear

	^self new initializeExpiringOn: aMonthOfYear! !
!CreditCard methodsFor: 'initialization' stamp: 'LNB 11/14/2021 19:09:42' prior: 50925829!
initializeExpiringOn: aMonthOfYear

	expiration := aMonthOfYear ! !
!CreditCard methodsFor: 'testing' stamp: 'LNB 11/14/2021 19:10:59' prior: 50925823!
isExpiredOn: aGregorianMonthOfYear

	^expiration start < (Month month: aGregorianMonthOfYear monthIndex year: aGregorianMonthOfYear yearNumber) start ! !
!CreditCard methodsFor: 'testing' stamp: 'LNB 11/14/2021 19:11:15' prior: 50964376!
isExpiredOn: aGregorianMonthOfYear

	^expiration < aGregorianMonthOfYear ! !
!Cashier class methodsFor: 'assertions' stamp: 'LNB 11/14/2021 19:12:19' prior: 50925744!
assertIsNotExpired: aCreditCard on: aGregorianMonthOfYear

	(aCreditCard isExpiredOn: aGregorianMonthOfYear) ifTrue: [self signalCanNotChargeAnExpiredCreditCard]! !
!TusLibrosSystemFacade methodsFor: 'time' stamp: 'LNB 11/14/2021 19:16:21'!
currentMonthOfYear

	^clock today monthOfYear! !
!CartSession methodsFor: 'cart' stamp: 'LNB 11/14/2021 19:16:59' prior: 50925632!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self currentMonthOfYear
		registeringOn: systemFacade salesBook) checkOut ! !
!CartSession methodsFor: 'time/expiration' stamp: 'LNB 11/14/2021 19:17:21'!
currentMonthOfYear

	^systemFacade currentMonthOfYear! !
!ManualClock methodsFor: 'initialization' stamp: 'LNB 11/14/2021 19:18:38' prior: 50925345!
initializeNow: aGregorianDateTime

	now := aGregorianDateTime ! !
!ManualClock class methodsFor: 'instance creation' stamp: 'LNB 11/14/2021 19:19:17' prior: 50925358!
now: aGregorianDateTime

	^self new initializeNow: aGregorianDateTime ! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 19:24:14'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 19:24:14'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:24:15'!
ERROR!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:24:15'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:24:15'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:24:15'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:24:15'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:24:15'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:24:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:24:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:24:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:24:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:24:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:24:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:16'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:17'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:24:17'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 19:24:22'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 19:24:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 19:24:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 19:24:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:24:23'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:24:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:24:23'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:24:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:24:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:24:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:24:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:24:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:24:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:24:39'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'LNB 11/14/2021 19:26:09' prior: 50926160!
sessionDuration

	^30*minute! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:26:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:26:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:26:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:26:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:26:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:26:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:26:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:26:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:26:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:12'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:26:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:26:42'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:26:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:26:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:26:42'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:26:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:26:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:26:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:26:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:26:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:44'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:26:44'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:26:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:26:46'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:26:56'!
ERROR!
!CartSession methodsFor: 'time/expiration' stamp: 'LNB 11/14/2021 19:27:07' prior: 50925588!
isExpiredAt: aTime

	^ (lastUsedTime next: systemFacade sessionDuration) < aTime! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:27:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:27:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:27:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:27:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:27:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:27:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:27:13'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:27:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:27:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:27:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:27:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:27:20'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:29:09'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:30:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:30:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:30:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:30:07'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:30:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:30:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:30:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:30:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:30:16'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:30:53'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:32:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:32:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:32:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:32:29'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:32:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:32:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:32:30'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:32:30'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:32:30'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:32:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:32:33'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:32:48'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:33:50'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:34:20'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:35:20'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:35:37'!
FAILURE!
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:37:26' prior: 50964233!
expiredMonthOfYear

	^ (today next: -1*month+0*second) monthOfYear.! !

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:37:28'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:37:33'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:37:33'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:37:46'!
FAILURE!

GregorianDateTime now next: -1*month!

GregorianDateTime now next: 1*month!

GregorianDateTime now next: 1!

GregorianDateTime now next: 1*month!

GregorianDate now next: 1*month!

GregorianDateTime now next: 1*second!

GregorianDateTime now next: 10000000000*second!

GregorianDateTime now next: 10000000000*month!
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:47:48' prior: 50965117!
expiredMonthOfYear

	^ (today previous: -1*month) monthOfYear.! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:47:53' prior: 50965149!
expiredMonthOfYear

	^ (today previous: 1*month) monthOfYear.! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:48:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:48:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:48:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:48:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:48:08'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:48:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:09'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:48:09'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:48:41'!
ERROR!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:48:41'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:48:41'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:48:41'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:48:41'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:48:41'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:48:42'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:48:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:48:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:48:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:48:43'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:48:43'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:48:56'!
ERROR!
!Cashier class methodsFor: 'assertions' stamp: 'LNB 11/14/2021 19:51:58' prior: 50964390!
assertIsNotExpired: aCreditCard on: aDate

	(aCreditCard isExpiredOn: aDate) ifTrue: [self signalCanNotChargeAnExpiredCreditCard]! !
!CreditCard methodsFor: 'testing' stamp: 'LNB 11/14/2021 19:52:12' prior: 50964384!
isExpiredOn: aDate

	^expiration < aDate ! !
!CreditCard methodsFor: 'testing' stamp: 'LNB 11/14/2021 19:52:23' prior: 50965367!
isExpiredOn: aGregorianDateTime

	^expiration < aGregorianDateTime ! !
!CreditCard methodsFor: 'testing' stamp: 'LNB 11/14/2021 19:53:01' prior: 50965372!
isExpiredOn: aGregorianDateTime

	^expiration < aGregorianDateTime monthOfYear! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:53:06'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:53:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:53:06'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:53:06'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:53:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:53:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:53:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:53:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:53:07'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:53:15'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:53:15'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:15'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:53:16'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:53:16'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:53:16'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:16'!
FAILURE!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:53:24'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:53:24'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:24'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:53:24'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:53:24'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:53:24'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:25'!
FAILURE!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:53:28'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:31'!
FAILURE!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:31'!
FAILURE!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:36'!
FAILURE!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:53:36'!
FAILURE!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:54:08'!
FAILURE!

GregorianDateTime now monthOfYear!

GregorianDateTime now previous:1*month monthOfYear!

GregorianDateTime now date previous:1*month monthOfYear!

GregorianDateTime now date next:1*month monthOfYear!

GregorianDateTime now date next:(1*month) monthOfYear!

GregorianDateTime now date!

(1*month) !

GregorianDateTime now date next:(1*month)!

GregorianDateTime now date next:(1*month) monthOfYear!

(GregorianDateTime now date next:(1*month)) monthOfYear!
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 19:58:05' prior: 50965155!
expiredMonthOfYear

	^ (today previous: (1*month)) monthOfYear.! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 19:58:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 19:58:17'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 19:58:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:58:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 19:58:18'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 19:58:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 19:58:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 19:58:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:58:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:58:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 19:58:18'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 19:58:18'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 19:58:24'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 19:58:24'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:58:24'!
FAILURE!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 19:58:24'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 19:58:24'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 19:58:24'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 19:58:24'!
FAILURE!

!classDefinition: #StoreTestObjectsFactory category: #'TusLibros-Tests' stamp: 'LNB 11/14/2021 19:59:50'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'todayAndNow'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 19:59:50' prior: 50925450!
today

	^ todayAndNow! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 19:59:50' prior: 50964212 overrides: 16896425!
initialize

	todayAndNow := GregorianDateTime now! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 19:59:50' prior: 50964239!
notExpiredMonthOfYear

	^ todayAndNow monthOfYear.! !
!StoreTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 19:59:50' prior: 50965541!
expiredMonthOfYear

	^ (todayAndNow previous: (1*month)) monthOfYear.! !
!StoreTestObjectsFactory methodsFor: 'date' stamp: 'LNB 11/14/2021 20:00:00' prior: 50965654!
today

	^ todayAndNow date! !
!StoreTestObjectsFactory methodsFor: 'dateTime' stamp: 'LNB 11/14/2021 20:00:26'!
now

	^ todayAndNow time.! !
!StoreTestObjectsFactory methodsFor: 'dateTime' stamp: 'LNB 11/14/2021 20:00:53'!
todayAndNow

	^ todayAndNow.! !

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:02:13'!
FAILURE!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:02:39'!
FAILURE!
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 20:03:27' prior: 50965671!
expiredMonthOfYear

	^ (self today previous: (1*month)) monthOfYear.! !

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:03:28'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:03:31'!
PASSED!
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'LNB 11/14/2021 20:03:49' prior: 50965665!
notExpiredMonthOfYear

	^ self today monthOfYear.! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 20:04:10'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 20:04:12'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 20:04:12'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 20:04:12'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 20:04:12'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:04:12'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 20:04:13'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 20:04:13'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 20:04:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:04:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:04:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:04:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:04:21'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:04:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:04:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:04:21'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:04:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:04:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:04:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:04:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:04:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:04:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:04:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:04:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:04:43'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'LNB 11/14/2021 20:06:01' prior: 50963669 overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory todayAndNow.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: self defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:07:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:07:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:07:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:07:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:07:07'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:07:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:08:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:08:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:08:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:08:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:08:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:08:13'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:08:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:08:38'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:09:29'!
ERROR!
!CartSession methodsFor: 'cart' stamp: 'LNB 11/14/2021 20:11:40' prior: 50964403!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!CartSession methodsFor: 'cart' stamp: 'HernanWilkinson 6/17/2015 20:35' prior: 50966012!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !

!methodRemoval: CartSession #currentMonthOfYear stamp: 'LNB 11/14/2021 20:12:18'!
currentMonthOfYear

	^systemFacade currentMonthOfYear!

!methodRemoval: TusLibrosSystemFacade #currentMonthOfYear stamp: 'LNB 11/14/2021 20:12:31'!
currentMonthOfYear

	^clock today monthOfYear!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:13:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:13:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:13:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:13:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:13:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:13:28'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:13:28'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:13:28'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:13:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:13:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:14:19'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'LNB 11/14/2021 20:15:31' prior: 50924930!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration next: 1* second) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:15:32'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'LNB 11/14/2021 20:15:48' prior: 50966132!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1* second) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:15:49'!
ERROR!

30*minute + 1*second!

(30*minute)+ (1*second)!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'LNB 11/14/2021 20:16:45' prior: 50966158!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: ((systemFacade sessionDuration) + (1* second)) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:16:47'!
ERROR!
!ManualClock methodsFor: 'time change' stamp: 'LNB 11/14/2021 20:17:13' prior: 50925328!
advanceTime: aDuration

	now := now next: aDuration ! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:17:19'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:17:19'!
ERROR!

----SNAPSHOT----(14 November 2021 20:19:03) CuisUniversity-4972.image priorSource: 20241658!

clock := ManualClock now: GregorianDateTime now.!

GregorianDateTime now.!

ManualClock now: GregorianDateTime now.!

GregorianDateTime now.!

ManualClock now: GregorianDateTime now.!

Object subclass: #ManualClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!CartSession methodsFor: 'time/expiration' stamp: 'LNB 11/14/2021 20:27:02' prior: 50964842!
isExpiredAt: aGregorianDateTime

	^ (lastUsedTime next: systemFacade sessionDuration) < aGregorianDateTime! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:27:20'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:27:20'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:27:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:27:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:27:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:27:22'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:27:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:27:24'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:27:52'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:28:10'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:28:31'!
ERROR!

systemFacade sessionDuration!

(lastUsedTime next: systemFacade sessionDuration)!

(lastUsedTime next: systemFacade sessionDuration) !

(lastUsedTime next: systemFacade sessionDuration) < aGregorianDateTime!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:33:30'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'LNB 11/14/2021 20:34:19' prior: 50926098!
sessionHasExpiredErrorDescription

	^'Can not use the cart after ', self sessionDuration printString , ' minutes of inactivity'! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:34:23'!
ERROR!
!ManualClock methodsFor: 'time change' stamp: 'LNB 11/14/2021 20:35:22' prior: 50925333!
revertTime: aDuration

	now := now previous: aDuration! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:35:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:29'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:29'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:35:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:38'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:55'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:35:55'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'LNB 11/14/2021 20:36:40' prior: 50925290!
test18CanNotListCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + (1* second)) .
	self
		should: [systemFacade listCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription ].

! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'LNB 11/14/2021 20:36:53' prior: 50966186!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1* second) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:36:54'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'LNB 11/14/2021 20:37:09' prior: 50966467!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: ((systemFacade sessionDuration) + (1* second)) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:37:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:26'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:37:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:26'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'LNB 11/14/2021 20:37:43' prior: 50925218!
test19CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + (1*second)) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	! !

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:37:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:37:45'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:37:50'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:37:51'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:37:52'!
PASSED!

Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #RealClock category: #'TusLibros-Tests' stamp: 'LNB 11/14/2021 20:38:42'!
Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!RealClock class methodsFor: 'no messages' stamp: 'LNB 11/14/2021 20:40:10'!
now: aGregorianDateTime

	^self new initializeNow: aGregorianDateTime ! !
!RealClock methodsFor: 'no messages' stamp: 'LNB 11/14/2021 20:40:27' overrides: 50925807!
today

	^now date! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:40:35'!
revertTime: aDuration

	now := now previous: aDuration! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:40:42' overrides: 50925803!
now

	^ now! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:40:49'!
initializeNow: aGregorianDateTime

	now := aGregorianDateTime ! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:40:58'!
advanceTime: aDuration

	now := now next: aDuration ! !
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:45:23' prior: 50963562!
clock

	^RealClock now! !
!RealClock class methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:46:46'!
now

	^self new initialize! !
!RealClock methodsFor: 'initialization' stamp: 'LNB 11/14/2021 20:47:03' overrides: 16896425!
initialize! !
!RealClock methodsFor: 'time' stamp: 'LNB 11/14/2021 20:47:30' prior: 50966858 overrides: 50925803!
now

	^ GregorianDateTime now! !
!RealClock methodsFor: 'time' stamp: 'LNB 11/14/2021 20:52:41' prior: 50966849 overrides: 50925807!
today

	^FixedGregorianDate today! !

Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #RealClock category: #'TusLibros-Model' stamp: 'LNB 11/14/2021 20:53:09'!
Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

Time!

!methodRemoval: RealClock #advanceTime: stamp: 'LNB 11/14/2021 20:58:19'!
advanceTime: aDuration

	now := now next: aDuration !

!methodRemoval: RealClock #revertTime: stamp: 'LNB 11/14/2021 20:58:21'!
revertTime: aDuration

	now := now previous: aDuration!

!methodRemoval: RealClock #initializeNow: stamp: 'LNB 11/14/2021 20:58:25'!
initializeNow: aGregorianDateTime

	now := aGregorianDateTime !

Clock subclass: #RealClock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #RealClock category: #'TusLibros-Model' stamp: 'LNB 11/14/2021 20:58:30'!
Clock subclass: #RealClock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!methodRemoval: RealClock class #now: stamp: 'LNB 11/14/2021 20:58:33'!
now: aGregorianDateTime

	^self new initializeNow: aGregorianDateTime !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'LNB 11/14/2021 20:58:38'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'LNB 11/14/2021 20:58:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'LNB 11/14/2021 20:58:40'!
PASSED!

!methodRemoval: RealClock #initialize stamp: 'LNB 11/14/2021 20:59:29'!
initialize!

!methodRemoval: RealClock class #now stamp: 'LNB 11/14/2021 20:59:34'!
now

	^self new initialize!
!InterfaceTestObjectsFactory methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 20:59:53' prior: 50966872!
clock

	^RealClock new! !

self!

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.!

TusLibrosInterface allInstances.!

server destroy!

TusLibrosInterface allInstances.!

self at: 1 put: nil!

self at: 2 put: nil!

self at: 3 put: nil!

TusLibrosInterface allInstances.!

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.!

!methodRemoval: TusLibrosInterface #helloWorld stamp: 'LNB 11/14/2021 21:03:33'!
helloWorld
	
	^'Hello World'.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/14/2021 21:13:10' prior: 50964167!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !

server destroy!

TusLibrosInterface allInstances.!

TusLibrosInterface allInstances.!

self at: 1 destroy!

(self at: 1) destroy!

(self at: 2) destroy!

(self at: 3) destroy!

(self at: 4) destroy!

TusLibrosInterface allInstances.!

interfaceObjectsFactory _ InterfaceTestObjectsFactory new.

server _ TusLibrosInterface listeningOn: 8080 interactingWith: interfaceObjectsFactory createSystemFacade.!

factory _ InterfaceTestObjectsFactory new!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosInterface allInstances.!

----QUIT----(14 November 2021 21:21:27) CuisUniversity-4972.image priorSource: 20306347!

----STARTUP---- (14 November 2021 21:21:38) as E:\Cursada Actual IS1\!!Ejercicio actual\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


----QUIT----(14 November 2021 21:21:54) CuisUniversity-4972.image priorSource: 20335275!

----STARTUP---- (14 November 2021 23:45:34) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!


----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\TusLibros-Model.st----!

----STARTUP---- (14 November 2021 23:46:25) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!

!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 23:47:07' prior: 50963857!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 23:47:28' prior: 50964121!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'me'.
	yearExpiration _ aRequest fields at: 'ye'.
	creditCardOwner _ aRequest fields at: 'co'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (Month month: monthExpiration year: yearExpiration).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 23:47:37' prior: 50963825!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 23:49:28' prior: 50967155!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'me'.
	yearExpiration _ aRequest fields at: 'ye'.
	creditCardOwner _ aRequest fields at: 'co'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !

factory _ InterfaceTestObjectsFactory new.
!

server destroy
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.
!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/14/2021 23:56:05' prior: 50967143!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !

----SNAPSHOT----(15 November 2021 00:45:18) CuisUniversity-4972.image priorSource: 20335506!

----STARTUP---- (15 November 2021 00:45:36) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!


----QUIT----(15 November 2021 00:45:46) CuisUniversity-4972.image priorSource: 20338707!

----STARTUP---- (15 November 2021 19:16:11) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!


CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 19:17:00'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 19:17:00'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 19:17:01'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 19:17:01'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Morphic\Morphic-Misc1\Morphic-Misc1.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\Packages\Morphic\Morphic-Widgets-Extras.pck.st----!

----End fileIn of C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\WordsClientDemo.st----!

Object subclass: #CustomerPurchaseHistory
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #CustomerPurchaseHistory category: #'TusLibros-Model' stamp: 'MF 11/15/2021 19:42:03'!
Object subclass: #CustomerPurchaseHistory
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

Object subclass: #SalesBook
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #SalesBook category: #'TusLibros-Model' stamp: 'MF 11/15/2021 19:48:07'!
Object subclass: #SalesBook
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #SalesBook category: #'TusLibros-Model' stamp: 'MF 11/15/2021 19:49:16'!
Object subclass: #SalesBook
	instanceVariableNames: 'sales'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!SalesBook methodsFor: 'no messages' stamp: 'MF 11/15/2021 19:49:15'!
salesDoneBy: aUser

	^sales select: [ :aSale | aSale wasDoneBy: aUser ]! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'MF 11/15/2021 19:49:32' prior: 50926253!
salesDoneBy: aUser

	^ salesBook salesDoneBy: aUser! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:50:37'!
add: aSale

	sales add: aSale.! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:50:52' overrides: 16896425!
initialize

	sales _ OrderedCollection new.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:51:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:51:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 19:51:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 19:51:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:51:50'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 19:51:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:51:54'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'MF 11/15/2021 19:52:34' prior: 50925051!
createSalesBook

	^SalesBook new! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 19:52:36'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:52:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:52:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 19:52:39'!
PASSED!
!CashierTest methodsFor: 'tests' stamp: 'MF 11/15/2021 19:52:57' prior: 50924816!
test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit

	| cart cashier salesBook creditCard |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := SalesBook new.
 	debitBehavior := [ :anAmount :aCreditCard | self error: Cashier creditCardHasNoCreditErrorMessage].

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	self
		should: [cashier checkOut ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier creditCardHasNoCreditErrorMessage.
			self assert: salesBook isEmpty ]! !

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:52:58'!
ERROR!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:53:03'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:53:14'!
isEmpty

	sales isEmpty.! !
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:53:16' prior: 50977570!
isEmpty

	^sales isEmpty.! !

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:53:17'!
PASSED!

!methodRemoval: SalesBook #isEmpty stamp: 'MF 11/15/2021 19:53:51'!
isEmpty

	^sales isEmpty.!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:53:52'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:54:05'!
isEmpty

	^sales isEmpty.! !
!CashierTest methodsFor: 'tests' stamp: 'MF 11/15/2021 19:54:10' prior: 50924791!
test05CashierChargesCreditCardUsingMerchantProcessor

	| cart cashier salesBook total creditCard debitedAmout debitedCreditCard  |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := SalesBook new.

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	debitBehavior := [ :anAmount :aCreditCard |
		debitedAmout := anAmount.
		debitedCreditCard := aCreditCard ].
	total := cashier checkOut total.

	self assert: debitedCreditCard = creditCard.
	self assert: debitedAmout = total.! !
!CashierTest methodsFor: 'tests' stamp: 'MF 11/15/2021 19:54:16' prior: 50924772!
test04CheckoutRegistersASale

	| cart cashier salesBook total |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	salesBook := SalesBook new.

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: testObjectsFactory notExpiredCreditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	total := cashier checkOut total.

	self assert: salesBook size = 1.
	self assert: salesBook first total = total.! !
!CashierTest methodsFor: 'tests' stamp: 'MF 11/15/2021 19:54:24' prior: 50924750!
test03CanNotCheckoutWithAnExpiredCreditCart

	| cart salesBook |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	salesBook := SalesBook new.

	self
		should: [ Cashier
				toCheckout: cart
				ownedBy: testObjectsFactory customer
				charging: testObjectsFactory expiredCreditCard
				throught: self
				on: testObjectsFactory today
				registeringOn: salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier canNotChargeAnExpiredCreditCardErrorMessage.
			self assert: salesBook isEmpty ]! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:54:29'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:54:29'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:54:29'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:54:43' overrides: 16880927!
size

	^sales size.! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:54:44'!
ERROR!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:54:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:54:44'!
ERROR!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:54:55'!
first

	^sales first.! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 19:54:58'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 19:54:58'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'MF 11/15/2021 19:56:18' prior: 50926217!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ salesBook purchaseHistoryOf: aUser ]
	
	"^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]"! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:56:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:56:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 19:56:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 19:56:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:56:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:56:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 19:56:21'!
PASSED!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 19:57:28'!
purchaseHistoryOf: aUser

	| purchaseHistory salesOfUser |
	salesOfUser _ self salesDoneBy: aUser.
	purchaseHistory _ CustomerPurchaseHistory new.
	salesOfUser do: [ :aSale | purchaseHistory registerSale: aSale ].
	^purchaseHistory! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 19:57:35'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 19:57:35'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 19:57:35'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 19:57:35'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:57:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 19:57:36'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 19:57:36'!
PASSED!

!classDefinition: #CustomerPurchaseHistory category: #'TusLibros-Model' stamp: 'MF 11/15/2021 19:58:14'!
Object subclass: #CustomerPurchaseHistory
	instanceVariableNames: 'purchases'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!CustomerPurchaseHistory methodsFor: 'no messages' stamp: 'MF 11/15/2021 19:57:54' overrides: 16896425!
initialize

	purchases _ Dictionary new.! !
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:07:25'!
registerSale: aSale

	aSale lineItemsDo: [ :newLineItem | | item |
		item _ newLineItem item.
		purchases at: item 
			ifPresent: [ :oldLineItem | 
				purchases at: item put: (LineItem of: item 
										quantity: (oldLineItem quantity + newLineItem quantity) 
										total: (oldLineItem total + newLineItem total))]
			ifAbsent: [ :oldLineItem | purchases at: item put: newLineItem ] ].! !
!LineItem methodsFor: 'initialization' stamp: 'MF 11/15/2021 20:07:42'!
quantity

	^quantity.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:07:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:07:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:07:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:07:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:07:47'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:07:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:07:49'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:08:04'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:08:22'!
ERROR!
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:08:58' prior: 50977950!
registerSale: aSale

	aSale lineItemsDo: [ :newLineItem | | item |
		item _ newLineItem item.
		purchases at: item 
			ifPresent: [ :oldLineItem | 
				purchases at: item put: (LineItem of: item 
										quantity: (oldLineItem quantity + newLineItem quantity) 
										total: (oldLineItem total + newLineItem total))]
			ifAbsent: [ purchases at: item put: newLineItem ] ].! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:09:02'!
ERROR!
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:10:03' overrides: 16880774!
at: anItem

	^purchases at: anItem.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:10:08'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:10:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:10:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:10:08'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:10:08'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:10:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:10:12'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'MF 11/15/2021 20:10:28' prior: 50925124!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) total equals: testObjectsFactory itemSellByTheStorePrice.
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:10:28'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:11:14'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:11:18'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:11:26'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:11:26'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:11:26'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:26'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:11:26'!
PASSED!
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:11:52'!
isEmpty

	^purchases isEmpty.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:11:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:11:56'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:11:56'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'MF 11/15/2021 20:12:06' prior: 50924952!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) total equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) total equals: testObjectsFactory anotherItemSellByTheStorePrice.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:12:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:12:12'!
PASSED!
!SalesBook methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:15:24' prior: 50977851!
purchaseHistoryOf: aUser

	| salesOfUser |
	salesOfUser _ self salesDoneBy: aUser.
	^CustomerPurchaseHistory forSales: salesOfUser.! !
!CustomerPurchaseHistory class methodsFor: 'no messages' stamp: 'MF 11/15/2021 20:16:35'!
forSales: salesOfUser

	| customerPurchaseHistory |
	customerPurchaseHistory _ self new.
	salesOfUser do: [ :aSale | customerPurchaseHistory registerSale: aSale ].
	^customerPurchaseHistory! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:16:42'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:16:42'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'MF 11/15/2021 20:19:09' prior: 50978246!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) total equals: testObjectsFactory itemSellByTheStorePrice.
	self assert: testObjectsFactory total equals: testObjectsFactory itemSellByTheStorePrice.
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:19:10'!
ERROR!
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:19:33'!
total

	^purchases sum: [ :aLineItem | aLineItem total ]! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:19:35'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'MF 11/15/2021 20:19:52' prior: 50978816!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) total equals: testObjectsFactory itemSellByTheStorePrice.
	self assert: testObjectsFactory itemSellByTheStorePrice equals: purchases total.
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:19:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:19:53'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'MF 11/15/2021 20:20:48' prior: 50978529!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases expectedTotal |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
	expectedTotal _ (testObjectsFactory itemSellByTheStorePrice * 2) + testObjectsFactory anotherItemSellByTheStorePrice.

	self assert: (purchases at: self validBook) total equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) total equals: testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: expectedTotal equals: purchases total.! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:20:50'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:20:50'!
PASSED!
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:22:47'!
items

	^purchases keys.! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:23:27'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:23:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:23:30'!
PASSED!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:24:11' prior: 50964155!
serializeTicket: aTicket

	| ticketDictionary |
	ticketDictionary _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | ticketDictionary at: aLineItem item put: aLineItem total ].
	ticketDictionary at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: ticketDictionary.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:25:04' prior: 50964192!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:25:21'!
serializePurchases: purchases

	! !
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:26:16'!
itemsDo: aBlock

	purchases keysDo: aBlock.! !

!methodRemoval: CustomerPurchaseHistory #items stamp: 'MF 11/15/2021 20:26:18'!
items

	^purchases keys.!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:28:31' prior: 50979273!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).]! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:29:06' prior: 50979286!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).].
	
	purchasesDictionary at: 'total' put: purchases total.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:29:17' prior: 50979300!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).].
	
	purchasesDictionary at: 'total' put: purchases total.
	
	^ WebUtils jsonEncode: purchasesDictionary.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:29:20'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:29:21'!
PASSED!

factory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.
!
!InterfaceTestObjectsFactory methodsFor: 'sales book' stamp: 'MF 11/15/2021 20:30:53' prior: 50963507!
createSalesBook

	^SalesBook new! !

server destroy
!

factory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.
!

server destroy
!

server destroy!

TusLibrosInterface allInstances.!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!


TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!

factory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.
!

TusLibrosInterface allInstances do: [ :aServer | aServer destroy ].!

factory _ InterfaceTestObjectsFactory new.
!

server _ TusLibrosInterface listeningOn: 8080 interactingWith: factory createSystemFacade.
!
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:34:35' prior: 50979259!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	self halt.
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!CustomerPurchaseHistory methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:35:52' prior: 50978846!
total

	^purchases sum: [ :aLineItem | aLineItem total ] ifEmpty: [ 0 ].! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:36:19' prior: 50979494!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:45:41' prior: 50967086!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:45:51'!
removeFromCart: aRequest

	! !
!TusLibrosInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:49:10' prior: 50979557!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'MF 11/15/2021 20:50:15'!
test21CanRemoveItemsToACreatedCartWithItems

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade remove: 1 of: self validBook toCartIdentifiedAs: cartId.
	
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'MF 11/15/2021 20:50:19' prior: 50979576!
test21CanRemoveItemsToACreatedCartWithItems

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade remove: 1 of: self validBook toCartIdentifiedAs: cartId.
	
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.! !

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 20:50:21'!
ERROR!
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:50:26'!
remove: aSmallInteger of: aString toCartIdentifiedAs: aSmallInteger3 
	self shouldBeImplemented.! !
!TusLibrosSystemFacade methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:51:30' prior: 50979613!
remove: anAmount of: aBook toCartIdentifiedAs: aCartId 
	
	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: anAmount of: aBook ]! !

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 20:51:32'!
ERROR!
!CartSession methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:51:39'!
removeFromCart: aSmallInteger of: aString 
	self shouldBeImplemented.! !
!CartSession methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 20:52:43' prior: 50979632!
removeFromCart: anAmount of: aBook 
	
	^cart remove: anAmount of: aBook.! !

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 20:52:48'!
ERROR!
!Cart methodsFor: 'removing' stamp: 'MF 11/15/2021 20:52:55'!
remove: aSmallInteger of: aString 
	self shouldBeImplemented.! !
!Cart methodsFor: 'removing' stamp: 'MF 11/15/2021 20:56:10' prior: 50979647!
remove: aQuantity of: anItem 
	
	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	aQuantity timesRepeat: [ items remove: anItem ]! !

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 20:56:12'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 20:56:12'!
PASSED!
!CartTest methodsFor: 'tests' stamp: 'MF 11/15/2021 20:57:08'!
test09CanNotRemoveItemsNotInCart

	| cart |

	cart := testObjectsFactory createCart.

	cart remove: 1 of: testObjectsFactory itemSellByTheStore.
	self assert: (cart occurrencesOf: testObjectsFactory itemSellByTheStore) = 2! !
!CartTest methodsFor: 'tests' stamp: 'MF 11/15/2021 20:57:57' prior: 50979742!
test09CanNotRemoveItemsNotInCart

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart remove: 2 of: testObjectsFactory itemSellByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart cartIsEmptyErrorMessage.
			self assert: cart isEmpty ]! !

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 20:57:59'!
ERROR!
!CartTest methodsFor: 'tests' stamp: 'MF 11/15/2021 20:58:22' prior: 50979752!
test09CanNotRemoveItemsNotInCart

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart remove: 2 of: testObjectsFactory itemSellByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart cartIsEmptyErrorMessage.
			self assert: cart isEmpty ]! !

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 20:58:23'!
ERROR!
!Cart class methodsFor: 'error messages' stamp: 'MF 11/15/2021 20:58:26'!
cartIsEmptyErrorMessage
	self shouldBeImplemented.! !
!Cart class methodsFor: 'error messages' stamp: 'MF 11/15/2021 20:58:41' prior: 50979784!
cartIsEmptyErrorMessage
	
	^'Cart is empty!!'.! !
!Cart class methodsFor: 'error messages' stamp: 'MF 11/15/2021 20:59:22'!
cannotRemoveFromEmptyCartErrorMessage
	
	^'Cart is empty!!'.! !

!methodRemoval: Cart class #cartIsEmptyErrorMessage stamp: 'MF 11/15/2021 20:59:22'!
cartIsEmptyErrorMessage
	
	^'Cart is empty!!'.!
!CartTest methodsFor: 'tests' stamp: 'MF 11/15/2021 20:59:42' prior: 50979768!
test09CanNotRemoveItemsNotInCart

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart remove: 2 of: testObjectsFactory itemSellByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart cannotRemoveFromEmptyCartErrorMessage.
			self assert: cart isEmpty ]! !

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 20:59:43'!
FAILURE!
!Cart methodsFor: 'removing' stamp: 'MF 11/15/2021 21:01:12' prior: 50979652!
remove: aQuantity of: anItem 
	
	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	aQuantity timesRepeat: [ items remove: anItem ifAbsent: [ self signalCannotRemoveFromEmptyCartError ] ]! !
!Cart methodsFor: 'error signal' stamp: 'MF 11/15/2021 21:01:30'!
signalCannotRemoveFromEmptyCartError

	self error: self class cannotRemoveFromEmptyCartErrorMessage.! !

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 21:01:32'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test20ListCatalogReturnsCatalog stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test21CanRemoveItemsToACreatedCartWithItems stamp: 'MF 11/15/2021 21:04:05'!
PASSED!

!classRenamed: #TusLibrosInterface as: #TusLibrosServerInterface stamp: 'MF 11/15/2021 21:13:49'!
Smalltalk renameClassNamed: #TusLibrosInterface as: #TusLibrosServerInterface!

Object subclass: #TusLibrosClientInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosClientInterface category: #'TusLibros-Model' stamp: 'MF 11/15/2021 21:14:41'!
Object subclass: #TusLibrosClientInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosClientInterface methodsFor: 'no messages' stamp: 'MF 11/15/2021 21:14:48'!
url
	
	^'http://localhost:', self port asString! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:14:54'!
port
	
	^port ifNil: [port:=8080].! !

Object subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosClientWindow category: #'TusLibros-Model' stamp: 'MF 11/15/2021 21:19:04'!
Object subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosClientWindow category: #'TusLibros-Model' stamp: 'MF 11/15/2021 21:19:15'!
SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosClientWindow class methodsFor: 'no messages' stamp: 'MF 11/15/2021 21:19:45'!
open

	^self new initializeWith: 'TusLibros - Client Window'! !
!TusLibrosClientWindow methodsFor: 'no messages' stamp: 'MF 11/15/2021 21:20:13'!
initializeWith: aTitle

	self setLabel: aTitle.! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:21:19' prior: 50980050!
initializeWith: aTitle

	self setLabel: aTitle.
	
	self openInWorld.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:00' prior: 50980057!
initializeWith: aTitle

	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:12'!
defaultExtent

	^ 1035@485
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:20' prior: 50980071!
defaultExtent

	^ 1035@800
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:41' prior: 50980064!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	
	
	self openInWorld.! !

Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosClientWindow category: #'TusLibros-Model' stamp: 'MF 11/15/2021 21:22:46'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:59' prior: 50980077 overrides: 50971675!
defaultExtent

	^ 1920@800
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:22:12' prior: 50980106 overrides: 50971675!
defaultExtent

	^ 1035@485
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:36:58' prior: 50980083!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:37:22' overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:37:58' prior: 50980128 overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:38:09' prior: 50980134 overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:38:21' prior: 50980112 overrides: 50971675!
defaultExtent

	^ 1035@600
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:38:33' prior: 50980151 overrides: 50971675!
defaultExtent

	^ 1280@720
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:38:53' prior: 50980143 overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:39:47'!
build1stRow

	| firstRowLayoutMorph |
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:40:29' prior: 50980170!
build1stRow

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2;
	addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:40:49' prior: 50980163 overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 1;
	addMorph: self build1stRow.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:41:14' prior: 50980189 overrides: 50971579!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:41:34' prior: 50980177!
build1stRow

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.2;
	addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:41:45' prior: 50980206!
build1stRow

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.2;
	addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:42:03' prior: 50980218!
build1stRow

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/15/2021 21:42:36' prior: 50980230!
build1stRow

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2.
	firstRowLayoutMorph addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!

----SNAPSHOT----(15 November 2021 22:41:21) CuisUniversity-4972.image priorSource: 20338928!

----QUIT----(15 November 2021 22:41:23) CuisUniversity-4972.image priorSource: 20755300!

----STARTUP---- (18 November 2021 17:41:19) as C:\Users\maxi\Desktop\Inge1 - Cuises\TusLibros it4\CuisUniversity-4972.image!


Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:42:21'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:43:59'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

Object subclass: #TusLibrosClientInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientInterface category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:45:22'!
Object subclass: #TusLibrosClientInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:45:51'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:45:52'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:45:52'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'no messages' stamp: 'MF 11/18/2021 17:45:49' overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:46:11'!
username

	^username! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:46:29'!
username: aUsername

	username _ aUsername.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:46:36'!
password

	^password.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:46:48'!
password: aPassword

	password _ aPassword.! !

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:54:19'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'usernameTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Views' stamp: 'MF 11/18/2021 17:54:20'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:54:17' prior: 50980241!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password.
	
	
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2.
	firstRowLayoutMorph addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:54:28' prior: 50980369!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
					
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	
	
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2.
	firstRowLayoutMorph addMorph: (LabelMorph contents: 'Welcome to TusLibros!!').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:56:00' prior: 50980389!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:56:14' prior: 50980118!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self openInWorld.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:56:48' prior: 50980409!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:57:05' prior: 50980450!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.2;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:57:44' prior: 50980482!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 25;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:57:53' prior: 50980517!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:58:57' prior: 50980553!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 100. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:59:10' prior: 50980589!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow!

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 17:59:26' prior: 50980625!
build1stRow

	| firstRowLayoutMorph |
	
	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:01:19'!
buildUsernameTextMorph

	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. ! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:01:44'!
buildPasswordTextMorph

	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 
! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:01:51' prior: 50980662!
build1stRow

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.

	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: usernameTextBoxMorph;
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:04:05' prior: 50980731!
build1stRow

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.
	
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (self buildLabeledTextMorphWith: usernameTextBoxMorph labeledBy: 'Username');
	addMorph: (self buildLabeledTextMorphWith: passwordTextBoxMorph labeledBy: 'Password').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:04:31'!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:05:33' prior: 50980760!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn.
	columnLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents: aLabelText);
	addMorph: aTextMorph.
	
	columnLayoutMorph layoutSpec fixedWidth: 390.
	
	^columnLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:05:43' prior: 50980768!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn.
	columnLayoutMorph separation: 5;
	axisEdgeWeight: 0.2;
	addMorph: (LabelMorph contents: aLabelText);
	addMorph: aTextMorph.
	
	columnLayoutMorph layoutSpec fixedWidth: 390.
	
	^columnLayoutMorph.
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:05:57' prior: 50980783!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn.
	columnLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents: aLabelText);
	addMorph: aTextMorph.
	
	columnLayoutMorph layoutSpec fixedWidth: 390.
	
	^columnLayoutMorph.
	! !

TusLibrosClientWindow open.!

SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Views' stamp: 'MF 11/18/2021 18:09:26'!
SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow open.!
!WordsClientWindow methodsFor: 'initialization' stamp: 'MF 11/18/2021 18:09:37' prior: 50976931!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (WordsClientWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosClientWindow open.!
!WordsClientWindow methodsFor: 'initialization' stamp: 'MF 11/18/2021 18:09:44' prior: 50980829!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (WordsClientWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:09:51' prior: 50980438!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self openInWorld.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:10:51' prior: 50980198!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	
	self layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1)
! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:14:55' prior: 50980874!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:15:24' prior: 50980885!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).
! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:17:30' prior: 50980347!
password: aPassword

	password _ aPassword.
	^true.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:17:35' prior: 50980338!
username: aUsername

	username _ aUsername.
	^true.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:18:09' prior: 50980744!
build1stRow

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (self buildLabeledTextMorphWith: usernameTextBoxMorph labeledBy: 'Username');
	addMorph: (self buildLabeledTextMorphWith: passwordTextBoxMorph labeledBy: 'Password').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:18:30' prior: 50980892!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow.
! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:20:20'!
build2ndRow

	^PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create Cart'
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:22:02' prior: 50980931!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 2 fixedHeight: 2).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:22:09' prior: 50980949!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 400 fixedHeight: 400).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:22:19' prior: 50980966!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 400 fixedHeight: 100).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:22:27' prior: 50980983!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 40 fixedHeight: 10).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:22:35' prior: 50981000!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:24:23'!
createCart

	| cartId |
	cartId _ restInterface createCartRequestFor: username with: password.
	
	self triggerEvent: #loginSuccessfulWithCartId: with: cartId asNumber.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:27:47'!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/words') fields: fieldDict method: 'GET'. "todo: cambiar a POST"
	
	resp isSuccess
		ifTrue:[ ^resp content ]
		ifFalse:[ ^self error: resp content ]
	! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'MF 11/18/2021 18:27:51' prior: 50981042!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/words') fields: fieldDict method: 'GET'. "todo: cambiar a POST"
	
	resp isSuccess
		ifTrue:[ ^resp content ]
		ifFalse:[ ^self error: resp content ]! !

----SNAPSHOT----(18 November 2021 21:00:56) CuisUniversity-4972.image priorSource: 20755394!

----QUIT----(18 November 2021 21:00:59) CuisUniversity-4972.image priorSource: 20781581!

----STARTUP---- (27 November 2021 14:10:20) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


s1 _ Switch new.
	s2 _ Switch new turnOn.
	s3 _ Switch new.
	s2 onAction: [s3 turnOff].
	s3 onAction: [s2 turnOff].
	b1 _ (PluggableButtonMorph model: s1 stateGetter: #isOn action: #switch) label: 'S1'.
	b2 _ (PluggableButtonMorph model: s2 stateGetter: #isOn action: #turnOn) label: 'S2'.
	b3 _ (PluggableButtonMorph model: s3 stateGetter: #isOn action: #turnOn) label: 'S3'.
	b1 color: `Color lightRed`.
	b2 color: `Color lightRed`.
	b3 color: `Color lightRed`.
	row _ LayoutMorph newRow
		addMorphs: (Array with: b1 with: b2 with: b3);
		morphExtent: `120@35`.
	^ row!

s1 _ Switch new.
	s2 _ Switch new turnOn.
	s3 _ Switch new.
	s2 onAction: [s3 turnOff].
	s3 onAction: [s2 turnOff].
	b1 _ (PluggableButtonMorph model: s1 stateGetter: #isOn action: #switch) label: 'S1'.
	b2 _ (PluggableButtonMorph model: s2 stateGetter: #isOn action: #turnOn) label: 'S2'.
	b3 _ (PluggableButtonMorph model: s3 stateGetter: #isOn action: #turnOn) label: 'S3'.
	b1 color: `Color lightRed`.
	b2 color: `Color lightRed`.
	b3 color: `Color lightRed`.
	row _ LayoutMorph newRow
		addMorphs: (Array with: b1 with: b2 with: b3);
		morphExtent: `120@35`.
	^ row!

PluggableButtonMorph example!

PluggableButtonMorph example!

PluggableButtonMorph example!

----STARTUP---- (27 November 2021 14:18:44) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!

!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:26:57' prior: 50980862!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self setActionSequence: [:cartId| ] forEvent: #loginSuccessfulWithCartId:.
	""
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:27:30' prior: 50981087!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self setActionSequence: [:cartId|  ] forEvent: #loginSuccessfulWithCartId:.
	""
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:28:21' prior: 50981101!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self setActionSequence: [:cartId| self layoutMorph beColumn. ] forEvent: #loginSuccessfulWithCartId:.
	""
	
	self openInWorld.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:28:49' prior: 50981033!
createCart

	| cartId |
	cartId _ 1."restInterface createCartRequestFor: username with: password."
	
	self triggerEvent: #loginSuccessfulWithCartId: with: cartId asNumber.! !

TusLibrosClientWindow open.!

self actionMaps
        at: anObject
        ifAbsent: nil!

----STARTUP---- (27 November 2021 14:35:31) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!

!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:36:40' prior: 50980862!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.

	self setActionSequence: [:cartId | self layoutMorph ] forEvent: #loginSuccessfulWithCartId:.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:37:01' prior: 50981147!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.

	self setActionSequence: [:cartId | self break ] forEvent: #loginSuccessfulWithCartId:.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:37:13' prior: 50981161!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.

	self setActionSequence: [:cartId | self halt ] forEvent: #loginSuccessfulWithCartId:.
	
	self openInWorld.! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:38:01' prior: 50981033!
createCart

	| cartId |
	cartId _ 1"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #loginSuccessfulWithCartId: with: cartId asNumber.! !

TusLibrosClientWindow open.!

self halt!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:41:49' prior: 50981175!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCartWithCatalog: to: self.
	
	self setActionSequence: [:cartId | self halt ] forEvent: #loginSuccessfulWithCartId:.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:41:59' prior: 50981201!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCartWithCatalog: to: self.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:42:22'!
displayCartWithCatalog: cartId

	self halt
! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:42:31' prior: 50981190!
createCart

	| cartId |
	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #loginSuccessfulWithCartId: with: cartId asNumber.! !

TusLibrosClientWindow open.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:46:12' prior: 50981232!
displayCartWithCatalog: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:46:57'!
displayCatalogAndCartContentsOf: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:46:57' prior: 50981218!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.! !

!methodRemoval: TusLibrosClientWindow #displayCartWithCatalog: stamp: 'LNB 11/27/2021 14:46:57'!
displayCartWithCatalog: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:47:35'!
buildMorphicWindowForLogin

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:47:35' prior: 50981260!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.! !

!methodRemoval: TusLibrosClientWindow #buildMorphicWindow stamp: 'LNB 11/27/2021 14:47:35'!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:48:39'!
buildMorphicWindowDisplayingCartContentsAndCatalog

	self layoutMorph beColumn.! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!

self delete!

SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 14:57:51'!
SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientCatalogAndCartContentsWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosClientCatalogAndCartContentsWindow class' category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 14:57:51'!
TusLibrosClientCatalogAndCartContentsWindow class
	instanceVariableNames: ''!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
build1stRow

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (self buildLabeledTextMorphWith: usernameTextBoxMorph labeledBy: 'Username');
	addMorph: (self buildLabeledTextMorphWith: passwordTextBoxMorph labeledBy: 'Password').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
build2ndRow

	^PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create Cart'
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn.
	columnLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents: aLabelText);
	addMorph: aTextMorph.
	
	columnLayoutMorph layoutSpec fixedWidth: 390.
	
	^columnLayoutMorph.
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
buildMorphicWindowDisplayingCartContentsAndCatalog

	self layoutMorph beColumn.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
buildMorphicWindowForLogin

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
buildPasswordTextMorph

	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 
! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
buildUsernameTextMorph

	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. ! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
defaultExtent

	^ 1280@720
! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
displayCatalogAndCartContentsOf: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 14:57:52'!
open

	^self new initializeWith: 'TusLibros - Client Window'! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:00:43' prior: 50981325!
buildMorphicWindowDisplayingCartContentsAndCatalog

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 15:02:30'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:02:28' prior: 50981237!
createCart

	cartId2 _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #loginSuccessfulWithCartId:.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 15:02:33'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:02:33' prior: 50981506!
createCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #loginSuccessfulWithCartId:.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:03:44' prior: 50981524!
createCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #loginSuccessfulWithCartId.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:03:49'!
displayCatalogAndCartContentsOf

	self buildMorphicWindowDisplayingCartContentsAndCatalog.! !

!methodRemoval: TusLibrosClientWindow #displayCatalogAndCartContentsOf: stamp: 'LNB 11/27/2021 15:03:58'!
displayCatalogAndCartContentsOf: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:04:44' prior: 50981532!
createCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:04:59' prior: 50981296!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:05:05'!
displayCatalogAndCartContents

	self buildMorphicWindowDisplayingCartContentsAndCatalog.! !

!methodRemoval: TusLibrosClientWindow #displayCatalogAndCartContentsOf stamp: 'LNB 11/27/2021 15:05:07'!
displayCatalogAndCartContentsOf

	self buildMorphicWindowDisplayingCartContentsAndCatalog.!
!TusLibrosClientCatalogAndCartContentsWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:06:36'!
openWithModel: aModel

	^self new initializeNamed: 'TusLibros - Client Window' modeledBy: aModel.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow class #open stamp: 'LNB 11/27/2021 15:06:41'!
open

	^self new initializeWith: 'TusLibros - Client Window'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:07:10'!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #initializeWith: stamp: 'LNB 11/27/2021 15:07:14'!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:17:38' prior: 50981600!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindowForLogin.
	
	"self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self."
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:17:49'!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:17:49'!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:17:49' prior: 50981630!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	"self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self."
	
	self openInWorld.! !
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:17:49' prior: 50981561!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	
	self openInWorld.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #buildMorphicWindowForLogin stamp: 'LNB 11/27/2021 15:17:49'!
buildMorphicWindowForLogin

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"!

!methodRemoval: TusLibrosClientWindow #buildMorphicWindowForLogin stamp: 'LNB 11/27/2021 15:17:50'!
buildMorphicWindowForLogin

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"!
!TusLibrosClientWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:18:25' prior: 50981489!
buildMorphicWindowDisplayingCartContentsAndCatalog

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:19:30' prior: 50981645!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build1stRow layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

----SNAPSHOT----(27 November 2021 15:19:35) CuisUniversity-4972.image priorSource: 20781675!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:19:54'!
build1stColumn

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (self buildLabeledTextMorphWith: usernameTextBoxMorph labeledBy: 'Username');
	addMorph: (self buildLabeledTextMorphWith: passwordTextBoxMorph labeledBy: 'Password').
	
	^firstRowLayoutMorph.
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:19:54' prior: 50981744!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #build1stRow stamp: 'LNB 11/27/2021 15:19:54'!
build1stRow

	| firstRowLayoutMorph |
	
	self buildUsernameTextMorph.
	self buildPasswordTextMorph.
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (self buildLabeledTextMorphWith: usernameTextBoxMorph labeledBy: 'Username');
	addMorph: (self buildLabeledTextMorphWith: passwordTextBoxMorph labeledBy: 'Password').
	
	^firstRowLayoutMorph.
	!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:21:50' prior: 50981783!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndRow layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: self build3stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:21:57'!
build2ndColumn

	^PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create Cart'
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:21:58' prior: 50981818!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: self build3stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #build2ndRow stamp: 'LNB 11/27/2021 15:21:58'!
build2ndRow

	^PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create Cart'
	
	!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:33:09' prior: 50981766!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogo').
	
	^firstRowLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:34:05' prior: 50981845!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: self build3rdColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:34:13'!
build3rdColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogo').
	
	^firstRowLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:34:29' prior: 50981903!
build3rdColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Carrito').
	
	^firstRowLayoutMorph.! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:34:58' prior: 50981915!
build3rdColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart').
	
	^firstRowLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:35:05' prior: 50981872!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue').
	
	^firstRowLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:35:31' prior: 50981837!
build2ndColumn

	^PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Checkout Cart'
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:35:39' prior: 50981951!
build2ndColumn

	^PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:54:06' prior: 50981939!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #wordsListIndex indexSetter: #wordsListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstRowLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:54:35' prior: 50981967!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstRowLayoutMorph.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #buildMorphicWindowDisplayingCartContentsAndCatalog stamp: 'LNB 11/27/2021 15:55:42'!
buildMorphicWindowDisplayingCartContentsAndCatalog

	self layoutMorph beColumn.!

TusLibrosClientWindow open.!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 15:57:18'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:57:13'!
catalogueProducts

	^catalogue.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 15:59:38' prior: 50982020!
catalogueProducts

	^restInterface catalog.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 16:00:42'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogue catalogueSelectionIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:00:40' prior: 50980328 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.! !

self model systemCategoryListIndex!

self model systemCategoryListIndex!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:04:27'!
catalogueListIndex

	^catalogueSelectionIndex.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:05:03'!
catalogueListIndex: aNewIndex

	catalogueSelectionIndex _ aNewIndex.
	^true.! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:06:35' prior: 50982025!
catalogueProducts

	^OrderedCollection with: 1 with: 2 with: 3.
	"^restInterface catalog."! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:07:01' prior: 50982056!
catalogueListIndex: aNewIndex

	catalogueSelectionIndex _ aNewIndex.
	"^true."! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:07:17' prior: 50982071!
catalogueListIndex: aNewIndex

	catalogueSelectionIndex _ aNewIndex.
	^true.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:09:11' prior: 50981928!
build3rdColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newRow.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:).
	
	^firstRowLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:09:22' prior: 50982085!
build3rdColumn

	| thirdRowLayoutMorph |
	
	thirdRowLayoutMorph _ LayoutMorph newRow.
	thirdRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:).
	
	^thirdRowLayoutMorph.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 16:09:58'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogue catalogueSelectionIndex cartSelectionIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:09:56'!
cartContentsIndex

	^cartSelectionIndex.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:10:22'!
cartContentsIndex: aNewIndex

	cartSelectionIndex _ aNewIndex.
	^true.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:10:36'!
cartContents

	^OrderedCollection with: 1 with: 2 with: 3.
	"^restInterface catalog."! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:11:51' prior: 50982041 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:11:53' prior: 50982145 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:12:37' prior: 50981985!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newColumn.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstRowLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:12:43' prior: 50982101!
build3rdColumn

	| thirdRowLayoutMorph |
	
	thirdRowLayoutMorph _ LayoutMorph newColumn.
	thirdRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:).
	
	^thirdRowLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:14:03' prior: 50982164!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newColumn.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
	
	^firstRowLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:15:44' prior: 50982200!
build1stColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newColumn.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstRowLayoutMorph.! !

----SNAPSHOT----(27 November 2021 16:15:47) CuisUniversity-4972.image priorSource: 20803538!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:16:36' prior: 50981959!
build2ndColumn

	| firstRowLayoutMorph |
	
	firstRowLayoutMorph _ LayoutMorph newColumn.
	firstRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^firstRowLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:16:45' prior: 50982242!
build2ndColumn

	| secondRowLayoutMorph |
	
	secondRowLayoutMorph _ LayoutMorph newColumn.
	secondRowLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondRowLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:16:54' prior: 50982220!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:17:05' prior: 50982264!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:17:14' prior: 50982183!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:).
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:18:27' prior: 50982305!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:19:24' prior: 50982344!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart');
	
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:19:40' prior: 50982372!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToAdd
								textSetter: #quantityToAdd:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart');
	
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:19:59' prior: 50982401!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToTransfer
								textSetter: #quantityToTransfer:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart');
	
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart'.
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:21:18' prior: 50982430!
build2ndColumn

	| secondColumnLayoutMorph |
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToTransfer
								textSetter: #quantityToTransfer:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart').
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 16:23:51'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogue catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:23:45'!
quantityToTransfer

	^quantityToTransferTextBoxContents.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:24:36'!
quantityToTransfer: aString

	quantityToTransferTextBoxContents.! !

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 16:28:50'!
SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph quantityToTransferTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:28:42' prior: 50982460!
build2ndColumn

	| secondColumnLayoutMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToTransfer
								textSetter: #quantityToTransfer:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart').
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:29:00' prior: 50982520!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph2 |
	
	quantityToTransferTextBoxMorph2 _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToTransfer
								textSetter: #quantityToTransfer:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart').
	
	^secondColumnLayoutMorph.
	
	
	
	! !

SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 16:29:22'!
SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:29:30' prior: 50982551!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (TextModelMorph
								textProvider: self model
								textGetter: #quantityToTransfer
								textSetter: #quantityToTransfer:);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart').
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:30:53' prior: 50982600!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: quantityToTransferTextBoxMorph;
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove');
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart').
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:32:34' prior: 50982502!
quantityToTransfer: transferableQuantityString

	quantityToTransferTextBoxContents _ transferableQuantityString.
	^true.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:33:34'!
addToCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:33:47'!
removeFromCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:33:51'!
checkoutCart

	cartId _ 52"restInterface createCartRequestFor: username with: password".
	
	self triggerEvent: #cartCreationSuccesful.! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:35:04' prior: 50982154 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ String new.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:35:12' prior: 50982699 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:38:42' prior: 50982632!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: quantityToTransferTextBoxMorph;
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:39:25' prior: 50982722!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: quantityToTransferTextBoxMorph;
	addMorph: quantityToTransferTextBoxMorph;
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:39:50' prior: 50982763!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph;
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:41:52' prior: 50982286!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:41:57' prior: 50982328!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:42:22' prior: 50981884!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build3rdColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:42:28' prior: 50982846!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: (PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:42:32' prior: 50982867!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: (PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	^thirdColumnLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:43:51' prior: 50982804!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:44:31' prior: 50982945!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 20);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:44:52' prior: 50982989!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:46:24' prior: 50982905!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: ((PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:46:44' prior: 50982926!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:47:06' prior: 50983033!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	quantityToTransferTextBoxMorph borderColor: Color black.
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:47:43' prior: 50983117!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	quantityToTransferTextBoxMorph borderWidth: 1; borderColor: Color black.
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !

TusLibrosClientWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:48:08' prior: 50983076!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: ((PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:48:12' prior: 50983098!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	^thirdColumnLayoutMorph.! !

TusLibrosClientWindow open.!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:53:31' prior: 50981059!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'GET'. "todo: cambiar a POST"
	
	resp isSuccess
		ifTrue:[ ^resp content ]
		ifFalse:[ ^self error: resp content ]! !

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:54:35' prior: 50981553!
createCart

	cartId _ restInterface createCartRequestFor: username with: password.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:54:43' prior: 50983274!
createCart

	cartId _ restInterface createCartRequestFor: username with: password.
	
	self halt.
	
	self triggerEvent: #cartCreationSuccesful.! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:58:13' prior: 50983282!
createCart

	cartId _ WebUtils jsonDecode: (restInterface createCartRequestFor: username with: password).
	
	self halt.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:58:29' prior: 50983291!
createCart

	cartId _ WebUtils jsonDecode: (restInterface createCartRequestFor: username with: password).
	
	self halt.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:01:30' prior: 50983252!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'GET'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:01:38' prior: 50983309!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:02:20' prior: 50983328!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	self halt.
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:58:13' prior: 50983300!
createCart

	cartId _ WebUtils jsonDecode: (restInterface createCartRequestFor: username with: password).
	
	self halt.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 16:54:43' prior: 50983368!
createCart

	cartId _ restInterface createCartRequestFor: username with: password.
	
	self halt.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:03:24' prior: 50983377!
createCart

	cartId _ restInterface createCartRequestFor: username with: password.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:05:02' prior: 50982063!
catalogueProducts

	^restInterface catalog.! !

TusLibrosClientWindow open.!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:05:22' prior: 50983348!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:07:11' prior: 50983394!
catalogueProducts

	^restInterface listCatalog.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:08:11'!
listCatalog

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	"fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }."
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:12:30' prior: 50983424!
listCatalog

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	
	resp _ WebClient htmlSubmit: (self url, '/listCatalog') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:12:41' prior: 50983442!
listCatalog

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	
	resp _ WebClient htmlSubmit: (self url, '/listCatalog') fields: nil method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:14:14' prior: 50983457!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog'). "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:14:18' prior: 50983472!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog').
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:14:38' prior: 50983484!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog').
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:15:51' prior: 50983495!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog').
	
	resp isSuccess 
        		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:16:04' prior: 50983506!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog').
	self halt.
	
	resp isSuccess 
        		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !

WebUtils jsonDecode: ((resp content) readStream).!

self at: 'validBook'!

self at: 'validBook'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:20:29' prior: 50983419!
catalogueProducts

	^restInterface listCatalog keys.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:20:41' prior: 50983517!
listCatalog

	| resp |
	
	resp _ WebClient httpGet: (self url, '/listCatalog').
	
	resp isSuccess 
        		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:25:17' prior: 50983531!
catalogueProducts

	| catalog |
	catalog _ restInterface listCatalog
	catalog keys do:[:aBookISBN | aBookISBN , ' | $' , catalog at: aBookISBN].! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:26:03' prior: 50983548!
catalogueProducts

	| catalog |
	catalog _ restInterface listCatalog.
	catalog keys do:[:aBookISBN | aBookISBN , ' | $' , catalog at: aBookISBN].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:27:08' prior: 50983558!
catalogueProducts

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , catalog at: aBookISBN].! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:27:44' prior: 50983567!
catalogueProducts

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , (catalog at: aBookISBN)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:27:56' prior: 50983577!
catalogueProducts

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , ((catalog at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:29:14' prior: 50982078!
catalogueListIndex: aNewIndex

	catalogueSelectionIndex _ aNewIndex.
	^true.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:31:29' prior: 50982673!
addToCart

	cartId _ restInterface addToCart: cartId.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:31:53' prior: 50983601!
addToCart

	cartId _ restInterface addToCartRequest: cartId.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:33:12'!
addToCartRequest: aCartId

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:34:24'!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !

!methodRemoval: TusLibrosClientInterface #addToCartRequest: stamp: 'LNB 11/27/2021 17:34:27'!
addToCartRequest: aCartId

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:35:07' prior: 50983632!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'. "todo: cambiar a POST"
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:35:28' prior: 50983667!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:35:33' prior: 50983400!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:35:36' prior: 50983706!
createCartRequestFor: aUsername with: aPassword

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:35:33' prior: 50983725!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:36:07' prior: 50983687!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!InterfaceTestObjectsFactory methodsFor: 'users and passwords' stamp: 'LNB 11/27/2021 17:38:43' prior: 50963459!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		at: self anotherValidInsecureUser put: self anotherValidInsecurePassword;
		yourself! !
!InterfaceTestObjectsFactory methodsFor: 'users and passwords' stamp: 'LNB 11/27/2021 17:38:56'!
anotherValidInsecureUser

	^'admin'! !
!InterfaceTestObjectsFactory methodsFor: 'users and passwords' stamp: 'LNB 11/27/2021 17:39:13'!
anotherValidInsecurePassword

	^'admin'! !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:41:52' prior: 50983608!
addToCart

	| bookISBN |
	bookISBN _ (catalogue keys at: catalogueSelectionIndex).

	cartId _ restInterface addToCartRequest: cartId for:  bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:42:07' prior: 50983803!
addToCart

	| bookISBN |
	bookISBN _ (catalogue keys at: catalogueSelectionIndex).

	cartId _ restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartCreationSuccesful.! !

Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 17:43:35'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:44:39' prior: 50983815!
addToCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	cartId _ restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartCreationSuccesful.! !

TusLibrosClientWindow open.!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:48:13' prior: 50983760!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:49:44' prior: 50983857!
addToCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartCreationSuccesful.! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:51:01' prior: 50983892!
addToCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartContentsModified.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:51:23' prior: 50981676!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #loginSuccessfulWithCartId: send: #displayCatalogAndCartContentsOf: to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:52:05' prior: 50983917!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	
	self openInWorld.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #displayCatalogAndCartContentsOf: stamp: 'LNB 11/27/2021 17:52:15'!
displayCatalogAndCartContentsOf: cartId

	self buildMorphicWindowDisplayingCartContentsAndCatalog.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:53:50'!
updateCartContents
	
	model ! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:54:21' prior: 50982137!
cartContents

	^restInterface listCartRequest.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:56:24' prior: 50983958!
cartContents

	^restInterface listCartRequestFor: cartId.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:59:26'!
listCartRequestFor: aCartId

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/listCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
		ifTrue:[^resp]
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 17:59:43' prior: 50983969!
listCartRequestFor: aCartId

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/listCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).]
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!

SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 18:09:01'!
SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #buildPasswordTextMorph stamp: 'LNB 11/27/2021 18:09:14'!
buildPasswordTextMorph

	passwordTextBoxMorph _ TextModelMorph
								textProvider: self model
								textGetter: #password
								textSetter: #password:.
	passwordTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].				
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. 
!

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #buildUsernameTextMorph stamp: 'LNB 11/27/2021 18:09:16'!
buildUsernameTextMorph

	usernameTextBoxMorph _ TextModelMorph 
								textProvider: self model 
								textGetter: #username 
								textSetter: #username:.
	usernameTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | usernameTextBoxMorph innerTextMorph acceptContents ].				
	usernameTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 1. !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #buildLabeledTextMorphWith:labeledBy: stamp: 'LNB 11/27/2021 18:09:27'!
buildLabeledTextMorphWith: aTextMorph labeledBy: aLabelText

	| columnLayoutMorph |
	columnLayoutMorph _ LayoutMorph newColumn.
	columnLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents: aLabelText);
	addMorph: aTextMorph.
	
	columnLayoutMorph layoutSpec fixedWidth: 390.
	
	^columnLayoutMorph.
	!

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 18:10:38'!
SystemWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:10:34' prior: 50983232!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	cartContentsPluggableList _ ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:10:52' prior: 50983953!
updateCartContents
	
	cartContentsPluggableList updateList.! !

TusLibrosClientWindow open.!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 18:13:39'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents changingList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:13:35' prior: 50983964!
cartContents

	"^restInterface listCartRequestFor: cartId."
	^changingList.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:13:52' prior: 50982710 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.
	
	changingList _ OrderedCollection new.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:14:10' prior: 50983905!
addToCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	changingList add: 1.
	
	self triggerEvent: #cartContentsModified.! !

TusLibrosClientWindow open.!

----SNAPSHOT----(27 November 2021 18:14:51) CuisUniversity-4972.image priorSource: 20818758!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:14:56' prior: 50984129!
addToCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartContentsModified.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:15:03' prior: 50984111!
cartContents

	^restInterface listCartRequestFor: cartId.
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:15:10' prior: 50984118 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.! !

Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 18:15:19'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:15:48' prior: 50983982!
listCartRequestFor: aCartId

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/listCart') fields: fieldDict method: 'POST'.
	
	self halt.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).]
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!

(WebUtils jsonDecode: ((resp content) readStream))!

^(WebUtils jsonDecode: ((resp content) readStream)).!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:18:12' prior: 50984157!
cartContents

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , ((catalog at: aBookISBN) asString)].

	"^restInterface listCartRequestFor: cartId."
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:18:17' prior: 50984213!
cartContents

	| cartContents |
	cartContents _ restInterface listCatalog.
	
	^cartContents keys collect:[:aBookISBN | aBookISBN , ' | $' , ((cartContents at: aBookISBN) asString)].

	"^restInterface listCartRequestFor: cartId."
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:18:58' prior: 50984224!
cartContents

	| cartContents |
	cartContents _ restInterface listCartRequestFor:cartId.
	
	^cartContents keys collect:[:aBookISBN | aBookISBN , ' | ' , ((cartContents at: aBookISBN) asString)].

	"^restInterface listCartRequestFor: cartId."
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:19:01' prior: 50984235!
cartContents

	| cartContents |
	cartContents _ restInterface listCartRequestFor:cartId.
	
	^cartContents keys collect:[:aBookISBN | aBookISBN , ' | ' , ((cartContents at: aBookISBN) asString)].
	! !

TusLibrosClientWindow open.!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:19:17' prior: 50984194!
listCartRequestFor: aCartId

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/listCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).]
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:22:10' prior: 50982681!
removeFromCart

	| bookISBN |
	bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface removeFromCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartContentsModified.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:24:42'!
removeFromCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/removeFromCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!
!InterfaceTestObjectsFactory methodsFor: 'users and passwords' stamp: 'LNB 11/27/2021 18:25:13' prior: 50983791!
anotherValidInsecurePassword

	^''! !
!InterfaceTestObjectsFactory methodsFor: 'users and passwords' stamp: 'LNB 11/27/2021 18:25:19' prior: 50983786!
anotherValidInsecureUser

	^''! !

TusLibrosClientWindow open.!

TusLibrosClientWindow open.!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'LNB 11/27/2021 18:35:29'!
test22CannotRemoveMoreItemsThanContainedInCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self 
		should: [systemFacade remove: 3 of: self validBook toCartIdentifiedAs: cartId.]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook).
			].
	
	"systemFacade remove: 3 of: self validBook toCartIdentifiedAs: cartId."
	
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'LNB 11/27/2021 18:35:35' prior: 50984318!
test22CannotRemoveMoreItemsThanContainedInCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self 
		should: [systemFacade remove: 3 of: self validBook toCartIdentifiedAs: cartId.]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook).
			].! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - remove from cart' stamp: 'LNB 11/27/2021 18:36:19'!
xtest22CannotRemoveMoreItemsThanContainedInCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self 
		should: [systemFacade remove: 3 of: self validBook toCartIdentifiedAs: cartId.]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook).
			].! !

!methodRemoval: TusLibrosSystemFacadeTest #test22CannotRemoveMoreItemsThanContainedInCart stamp: 'LNB 11/27/2021 18:36:37'!
test22CannotRemoveMoreItemsThanContainedInCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self 
		should: [systemFacade remove: 3 of: self validBook toCartIdentifiedAs: cartId.]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook).
			].!
!CartTest methodsFor: 'tests' stamp: 'LNB 11/27/2021 18:40:14'!
test10CannotRemoveMoreItemsThanContainedInCart

	| cart |

	cart := testObjectsFactory createCart.

	cart add: 2 of: testObjectsFactory itemSellByTheStore.
	
	self 
		should: [self remove: 3 of: testObjectsFactory itemSellByTheStore]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: (cart occurrencesOf: testObjectsFactory itemSellByTheStore).
			].! !

!testRun: #CartTest #test10CannotRemoveMoreItemsThanContainedInCart stamp: 'LNB 11/27/2021 18:40:16'!
ERROR!
!CartTest methodsFor: 'tests' stamp: 'LNB 11/27/2021 18:40:29' prior: 50984410!
test10CannotRemoveMoreItemsThanContainedInCart

	| cart |

	cart := testObjectsFactory createCart.

	cart add: 2 of: testObjectsFactory itemSellByTheStore.
	
	self 
		should: [cart remove: 3 of: testObjectsFactory itemSellByTheStore]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: (cart occurrencesOf: testObjectsFactory itemSellByTheStore).
			].! !

	self !

!testRun: #CartTest #test10CannotRemoveMoreItemsThanContainedInCart stamp: 'LNB 11/27/2021 18:40:31'!
FAILURE!
!CartTest methodsFor: 'tests' stamp: 'LNB 11/27/2021 18:41:35' prior: 50979802!
test09CanNotRemoveItemsNotInCart

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart remove: 2 of: testObjectsFactory itemSellByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cart invalidQuantityErrorMessage.
			self assert: cart isEmpty ]! !
!Cart methodsFor: 'removing' stamp: 'LNB 11/27/2021 18:44:33' prior: 50979819!
remove: aQuantity of: anItem 
	
	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.
	
	(aQuantity > self occurrencesOf: anItem) ifTrue: [ self signalCannotRemoveFromEmptyCartError ].

	aQuantity timesRepeat: [ items remove: anItem ifAbsent: [ self shouldNotHappen ] ].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'LNB 11/27/2021 18:44:49'!
PASSED!

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'LNB 11/27/2021 18:44:49'!
ERROR!

!testRun: #CartTest #test10CannotRemoveMoreItemsThanContainedInCart stamp: 'LNB 11/27/2021 18:44:49'!
ERROR!

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'LNB 11/27/2021 18:44:55'!
ERROR!
!Cart methodsFor: 'removing' stamp: 'LNB 11/27/2021 18:45:15' prior: 50984467!
remove: aQuantity of: anItem 
	
	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.
	
	(aQuantity > (self occurrencesOf: anItem)) ifTrue: [ self signalCannotRemoveFromEmptyCartError ].

	aQuantity timesRepeat: [ items remove: anItem ifAbsent: [ self shouldNotHappen ] ].! !

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'LNB 11/27/2021 18:45:17'!
FAILURE!
!Cart methodsFor: 'error signal' stamp: 'LNB 11/27/2021 18:45:49' prior: 50979828!
signalCannotRemoveFromEmptyCartError

	self error: self class invalidQuantityErrorMessage.! !
!Cart methodsFor: 'error signal' stamp: 'LNB 11/27/2021 18:46:46'!
signalNotEnoughItemsToRemoveError

	self error: self class invalidQuantityErrorMessage.! !
!Cart methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:46:46' prior: 50984514!
remove: aQuantity of: anItem 
	
	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.
	
	(aQuantity > (self occurrencesOf: anItem)) ifTrue: [ self signalNotEnoughItemsToRemoveError ].

	aQuantity timesRepeat: [ items remove: anItem ifAbsent: [ self shouldNotHappen ] ].! !

!methodRemoval: Cart #signalCannotRemoveFromEmptyCartError stamp: 'LNB 11/27/2021 18:46:46'!
signalCannotRemoveFromEmptyCartError

	self error: self class invalidQuantityErrorMessage.!

!testRun: #CartTest #test09CanNotRemoveItemsNotInCart stamp: 'LNB 11/27/2021 18:46:54'!
PASSED!

!testRun: #CartTest #test10CannotRemoveMoreItemsThanContainedInCart stamp: 'LNB 11/27/2021 18:46:55'!
PASSED!

TusLibrosClientWindow open.!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 18:59:11'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 18:59:09' prior: 50982689!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId.
	
	self triggerEvent: #checkoutCartSuccess.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 19:07:12'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 19:07:13'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn ccme'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 19:07:14'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn ccme ccye'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:07:11' prior: 50984164 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current asNumber asString.
	ccye _ GregorianYear current asNumber asString.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:09:59' prior: 50984579!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCYE: ccye withCCME: ccme withCCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:11:01'!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp aBookISBN anAmount |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:11:18' prior: 50984639!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCYE: ccye withCCME: ccme withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosServerInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:12:03' prior: 50967193!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:12:41' prior: 50984648!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp aBookISBN anAmount |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aBookISBN. 'ccme'. anAmount. 'ccye'. anAmount. 'cco'. anAmount. }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:12:59' prior: 50984701!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCYE. 'ccye'. aCCME. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:13:20' prior: 50984718!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCYE. 'ccye'. aCCME. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:13:44' prior: 50984734!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCYE. 'ccye'. aCCME. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:15:15' prior: 50984623 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current number asString.
	ccye _ GregorianYear current number asString.! !

TusLibrosClientWindow open.!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosServerInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:17:44' prior: 50984674!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	self halt.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !

TusLibrosClientWindow open.!

----SNAPSHOT----(27 November 2021 19:19:30) CuisUniversity-4972.image priorSource: 20879695!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:23:40' prior: 50984750!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCYE. 'ccye'. aCCME. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST';timeout: 3.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientWindow open.!

yearExpiration asNumber!

monthExpiration asNumber!
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:26:27' prior: 50984825!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCME. 'ccye'. aCCYE. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST';timeout: 3.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:26:45'!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCME: aCCME withCCYE: aCCYE withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCME. 'ccye'. aCCYE. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST';timeout: 3.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !

!methodRemoval: TusLibrosClientInterface #checkoutCartRequestFor:withCCN:withCCYE:withCCME:withCCO: stamp: 'LNB 11/27/2021 19:26:48'!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCYE: aCCYE withCCME: aCCME withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCME. 'ccye'. aCCYE. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST';timeout: 3.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:27:07' prior: 50984665!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosServerInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:27:34' prior: 50984794!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:28:24' prior: 50984864!
checkoutCartRequestFor: aCartId withCCN: aCCN withCCME: aCCME withCCYE: aCCYE withCCO: aCCO

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'ccn'. aCCN. 'ccme'. aCCME. 'ccye'. aCCYE. 'cco'. aCCO. }.
	
	resp _ WebClient htmlSubmit: (self url, '/checkoutCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
		ifTrue:[^WebUtils jsonDecode: ((resp content) readStream).] 
        		ifFalse:[^self error: resp content].! !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:29:29' prior: 50984901!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self halt.
	
	self triggerEvent: #checkoutCartSuccess.! !

TusLibrosClientWindow open.!

----QUIT----(27 November 2021 19:31:06) CuisUniversity-4972.image priorSource: 20901445!

----STARTUP---- (27 November 2021 19:33:08) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


----QUIT----(27 November 2021 19:39:31) CuisUniversity-4972.image priorSource: 20906268!

----STARTUP---- (27 November 2021 19:44:59) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 19:47:10' prior: 50984962!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !

TusLibrosServerInterface allInstances.!

self at: 'El Seor de los anillos' put: 2000*peso!

self updateList!

self updateList!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosServerInterface allInstances.!

TusLibrosServerInterface allInstances.!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

server destroy!

server _ TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosServerInterface allInstances.!

Smalltalk garbageCollectMost !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Smalltalk garbageCollectMost !

TusLibrosServerInterface allInstances.!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances.!

TusLibrosClientWindow open.!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances.!

self !

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances.!

TusLibrosServerInterface allInstances.!

TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosServerInterface allInstances.!

factory _ InterfaceTestObjectsFactory new.!

TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosServerInterface allInstances.!

self at: 'El Seor de los Anillos' put: 2000*peso!

TusLibrosClientWindow open.!

TusLibrosServerInterface allInstances do: [ :aServer | aServer destroy ].!

Smalltalk garbageCollectMost !

TusLibrosServerInterface allInstances.!

Utilities garbageCollectAndReport !

TusLibrosServerInterface allInstances.!

TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientWindow open.!

TusLibrosServerInterface allInstances.!

self at: 'El Seor de los Anillos' put: 2000!

TusLibrosClientWindow open.!

TusLibrosServerInterface allInstances.!

self at: 'A Song of Ice and Fire - A Game Of Thrones Story' put: 3000!

TusLibrosServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosServerInterface allInstances.!

self at: 'A Song of Ice and Fire - A Game Of Thrones Story' put: 100!

self at: 'El Seor de los Anillos' put: 80!

TusLibrosClientWindow open.!

----STARTUP---- (27 November 2021 22:03:38) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


TusLibrosServerInterface allInstances.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:05:55' prior: 50983932!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #updateCartContents to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:06:45' prior: 50984990!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:06:52'!
displaySaleTicketWindow! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:07:05' prior: 50984962!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:07:42' prior: 50985028!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess: with: ticket.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:08:08' prior: 50985007!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess: send: #displaySaleTicketWindow: to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:08:24'!
displaySaleTicketWindow: aTicket! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #displaySaleTicketWindow stamp: 'LNB 11/27/2021 22:08:26'!
displaySaleTicketWindow!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:09:35' prior: 50985037!
checkoutCart

	ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:10:57'!
displaySaleTicketWindow

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !

!methodRemoval: TusLibrosClientCatalogAndCartContentsWindow #displaySaleTicketWindow: stamp: 'LNB 11/27/2021 22:11:00'!
displaySaleTicketWindow: aTicket!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:11:10' prior: 50985047!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.! !

!classDefinition: #TusLibrosClientTicketDisplayWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:12:25'!
Object subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:12:10' prior: 50985083!
displaySaleTicketWindow

	TusLibrosClientTicketDisplayWindow openWithModel: self model.
	self delete.! !

!classRenamed: #TusLibrosClientWindow as: #TusLibrosClientMainWindow stamp: 'LNB 11/27/2021 22:12:33'!
Smalltalk renameClassNamed: #TusLibrosClientWindow as: #TusLibrosClientMainWindow!

SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:12:58'!
SystemWindow subclass: #TusLibrosClientWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientTicketDisplayWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:13:20'!
TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow subclass: #TusLibrosClientMainWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientMainWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:13:25'!
TusLibrosClientWindow subclass: #TusLibrosClientMainWindow
	instanceVariableNames: 'usernameTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientCatalogAndCartContentsWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:13:30'!
TusLibrosClientWindow subclass: #TusLibrosClientCatalogAndCartContentsWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:14:25' prior: 50985121!
displaySaleTicketWindow

	TusLibrosClientWindow openWithModel: self model.
	self delete.! !

!classRemoval: #TusLibrosClientTicketDisplayWindow stamp: 'LNB 11/27/2021 22:14:28'!
TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientTicketDisplayWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:23:53'!
TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientTicketDisplayWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosClientTicketDisplayWindow class' category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:23:53'!
TusLibrosClientTicketDisplayWindow class
	instanceVariableNames: ''!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:53'!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: ((PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:53'!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	quantityToTransferTextBoxMorph borderWidth: 1; borderColor: Color black.
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:53'!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	cartContentsPluggableList _ ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:53'!
buildMorphicWindow

	self layoutMorph beRow;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build3rdColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:54'!
defaultExtent

	^ 1280@720
! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:54'!
displaySaleTicketWindow

	TusLibrosClientWindow openWithModel: self model.
	self delete.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:54'!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:54'!
updateCartContents
	
	cartContentsPluggableList updateList.! !
!TusLibrosClientTicketDisplayWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:23:54'!
openWithModel: aModel

	^self new initializeNamed: 'TusLibros - Client Window' modeledBy: aModel.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:25:26' prior: 50985320!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build3rdColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:26:46' prior: 50985380!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build3rdColumn layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:27:08'!
buildButtonsRow

	| thirdColumnLayoutMorph |
	
	cartContentsPluggableList _ ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:27:08' prior: 50985400!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

!methodRemoval: TusLibrosClientTicketDisplayWindow #build3rdColumn stamp: 'LNB 11/27/2021 22:27:08'!
build3rdColumn

	| thirdColumnLayoutMorph |
	
	cartContentsPluggableList _ ((PluggableListMorph model: self model listGetter: #cartContents indexGetter: #cartContentsIndex indexSetter: #cartContentsIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:27:45' prior: 50985440!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: self build1stColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:28:11' prior: 50985480!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:30:37' prior: 50985503!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: self build2ndColumn layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:31:50' prior: 50985526!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 0;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model lastTicketTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

!methodRemoval: TusLibrosClientTicketDisplayWindow #build1stColumn stamp: 'LNB 11/27/2021 22:31:56'!
build1stColumn

	| firstColumnLayoutMorph |
	
	firstColumnLayoutMorph _ LayoutMorph newColumn.
	firstColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Catalogue');
	addMorph: ((PluggableListMorph model: self model listGetter: #catalogueProducts indexGetter: #catalogueListIndex indexSetter: #catalogueListIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	"firstRowLayoutMorph borderColor: Color skyBlue; borderWidth: 1; morphWidth:300."
	
	^firstColumnLayoutMorph.!

!methodRemoval: TusLibrosClientTicketDisplayWindow #build2ndColumn stamp: 'LNB 11/27/2021 22:31:58'!
build2ndColumn

	| secondColumnLayoutMorph quantityToTransferTextBoxMorph |
	
	quantityToTransferTextBoxMorph _ 
		(TextModelMorph
			textProvider: self model
			textGetter: #quantityToTransfer
			textSetter: #quantityToTransfer:).
			
	quantityToTransferTextBoxMorph innerTextMorph 
							setProperty: #keyStroke: 
							toValue: [ :key | quantityToTransferTextBoxMorph innerTextMorph acceptContents ].	
	
	quantityToTransferTextBoxMorph borderWidth: 1; borderColor: Color black.
	
	secondColumnLayoutMorph _ LayoutMorph newColumn.
	secondColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Quantity to transfer:');
	addMorph: quantityToTransferTextBoxMorph layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 25);
								
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #removeFromCart label: 'Remove') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #checkoutCart label: 'Checkout Cart') layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	^secondColumnLayoutMorph.
	
	
	
	!

!methodRemoval: TusLibrosClientTicketDisplayWindow #displaySaleTicketWindow stamp: 'LNB 11/27/2021 22:32:07'!
displaySaleTicketWindow

	TusLibrosClientWindow openWithModel: self model.
	self delete.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:33:03'!
lastTicketDisplay

	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:33:26' prior: 50985654!
lastTicketDisplay

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , ((catalog at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:33:54' prior: 50985659!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ restInterface listCatalog.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:34:00' prior: 50985668!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:34:55' prior: 50985678!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket.
	ticketForDisplay removeKey: 'Total'
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:35:00' prior: 50985688!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket.
	ticketForDisplay removeKey: 'Total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:35:24' prior: 50985699!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket copy.
	ticketForDisplay removeKey: 'Total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:37:57' prior: 50985710!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket copy.
	self halt.
	ticketForDisplay removeKey: 'Total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 22:38:43'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn ccme ccye ticketSelectedIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:38:37'!
ticketIndex

	^ticketSelectedIndex.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:39:13'!
ticketIndex: aSelectionIndex

	ticketSelectedIndex _ aSelectionIndex.
	^true.! !

TusLibrosClientWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:40:05' prior: 50985194!
displaySaleTicketWindow

	TusLibrosClientTicketDisplayWindow openWithModel: self model.
	self delete.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:40:42' prior: 50985721!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket copy.
	self halt.
	ticketForDisplay removeKey: 'total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:41:30' prior: 50984770 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.
	
	ticketSelectedIndex _ 0.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current number asString.
	ccye _ GregorianYear current number asString.! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:41:50' prior: 50985766!
lastTicketDisplay

	| ticketForDisplay |
	ticketForDisplay _ ticket copy.
	ticketForDisplay removeKey: 'total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:42:31'!
lastTicketTotal
	
	^ticket at: 'total'.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:43:17' prior: 50985807!
lastTicketTotal
	
	^(ticket at: 'total') asNumber.! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:43:45' prior: 50985812!
lastTicketTotal
	
	^(ticket at: 'total') asString.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:45:37' prior: 50985554!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model lastTicketTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:47:16' prior: 50985825!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model lastTicketTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:50:40' prior: 50985419!
buildButtonsRow

	| thirdColumnLayoutMorph |
	
	cartContentsPluggableList _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:52:13' prior: 50985884!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton |
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newColumn.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: cartContentsPluggableList.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:53:53' prior: 50985904!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton logOutButton |
	
	logOutButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #logOut label: 'Log out') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newRow.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: (LabelMorph contents: 'Cart');
	addMorph: createNewCartButton.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:54:10' prior: 50985924!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton logOutButton |
	
	logOutButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #logOut label: 'Log out') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newRow.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: logOutButton;
	addMorph: createNewCartButton.
	
	^thirdColumnLayoutMorph.! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:55:59' prior: 50985351!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:56:44' prior: 50981575!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !

!methodRemoval: TusLibrosClientMainWindow #buildMorphicWindowDisplayingCartContentsAndCatalog stamp: 'LNB 11/27/2021 22:56:48'!
buildMorphicWindowDisplayingCartContentsAndCatalog

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 22:56:58'!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:01:35'!
logOut

	| catalog |
	catalog _ restInterface listCatalog.
	
	^catalog keys collect:[:aBookISBN | aBookISBN , ' | $' , ((catalog at: aBookISBN) asString)].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:02:43' prior: 50986022!
logOut

	
	self triggerEvent: #succesfullyLoggedOut.
	
	TusLibrosClientMainWindow open.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:02:51' prior: 50986031!
logOut

	self triggerEvent: #succesfullyLoggedOut.
	
	TusLibrosClientMainWindow open.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:03:21' prior: 50985979!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	
	self openInWorld.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:03:30'!
logOut

	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:04:03' prior: 50986038!
logOut

	self triggerEvent: #succesfullyLoggedOut.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:04:05' prior: 50986061!
logOut

	TusLibrosClientMainWindow open.
	self delete.! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:16:15' prior: 50985951!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton logOutButton listPurchasesButton |
	
	logOutButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #logOut label: 'Log out') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	listPurchasesButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #listPurchases label: 'List Purchases') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newRow.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: logOutButton;
	addMorph: createNewCartButton;
	addMorph: listPurchasesButton.
	
	^thirdColumnLayoutMorph.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:17:26'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn ccme ccye ticketSelectedIndex lastPurchaseHistoryRequest'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:17:22'!
listPurchases

	lastPurchaseHistoryRequest _ restInterface listPurchasesRequestFor: username withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:18:00' prior: 50986126!
listPurchases

	lastPurchaseHistoryRequest _ restInterface listPurchasesRequestFor: username authenticatingWith: password.
	
	self triggerEvent: #checkoutCartSuccess.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:18:19' prior: 50986136!
listPurchases

	lastPurchaseHistoryRequest _ restInterface listPurchasesRequestFor: username authenticatingWith: password.
	
	self triggerEvent: #listPurchasesInNewWindow.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:18:38' prior: 50986145!
listPurchases

	lastPurchaseHistoryRequest _ restInterface listPurchasesRequestFor: username authenticatingWith: password.
	
	self triggerEvent: #purchasesArrived.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:19:03'!
listPurchasesRequestFor: aUsername authenticatingWith: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:19:38' prior: 50986154!
listPurchases

	lastPurchaseHistoryRequest _ restInterface listPurchasesRequestFor: username authenticatingWith: password.
	
	self triggerEvent: #purchaseHistoryArrived.! !
!TusLibrosClientInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:21:36' prior: 50986163!
listPurchasesRequestFor: aUsername authenticatingWith: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/listPurchases') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:22:36' prior: 50986045!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:22:46'!
createNewWindowForPurchaseHistory
	
	! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:23:22' prior: 50986229!
createNewWindowForPurchaseHistory
	
	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.! !

TusLibrosClientWindow subclass: #TusLibrosClientPurchaseHistoryWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientPurchaseHistoryWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:26:44'!
TusLibrosClientWindow subclass: #TusLibrosClientPurchaseHistoryWindow
	instanceVariableNames: 'cartContentsPluggableList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientPurchaseHistoryWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosClientPurchaseHistoryWindow class' category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:26:44'!
TusLibrosClientPurchaseHistoryWindow class
	instanceVariableNames: ''!
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton logOutButton listPurchasesButton |
	
	logOutButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #logOut label: 'Log out') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	listPurchasesButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #listPurchases label: 'List Purchases') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newRow.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: logOutButton;
	addMorph: createNewCartButton;
	addMorph: listPurchasesButton.
	
	^thirdColumnLayoutMorph.! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Ticket:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model lastTicketTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
createNewWindowForPurchaseHistory
	
	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
defaultExtent

	^ 1280@720
! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:44'!
logOut

	TusLibrosClientMainWindow open.
	self delete.! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:45'!
updateCartContents
	
	cartContentsPluggableList updateList.! !
!TusLibrosClientPurchaseHistoryWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:26:45'!
openWithModel: aModel

	^self new initializeNamed: 'TusLibros - Client Window' modeledBy: aModel.! !

TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientTicketDisplayWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:26:55'!
TusLibrosClientWindow subclass: #TusLibrosClientTicketDisplayWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientWindow subclass: #TusLibrosClientPurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientPurchaseHistoryWindow category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:26:59'!
TusLibrosClientWindow subclass: #TusLibrosClientPurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!methodRemoval: TusLibrosClientTicketDisplayWindow #updateCartContents stamp: 'LNB 11/27/2021 23:27:28'!
updateCartContents
	
	cartContentsPluggableList updateList.!

!methodRemoval: TusLibrosClientPurchaseHistoryWindow #updateCartContents stamp: 'LNB 11/27/2021 23:27:42'!
updateCartContents
	
	cartContentsPluggableList updateList.!
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:28:26' prior: 50986302!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model lastTicketTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:31:04' prior: 50986428!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #lastTicketDisplay indexGetter: #ticketIndex indexSetter: #ticketIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model purchaseHistoryTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1);
	
	addMorph: self buildButtonsRow layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:31:52' prior: 50986457!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #purchaseHistoryDisplay indexGetter: #purchaseHistoryIndex indexSetter: #purchaseHistoryIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model purchaseHistoryTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).
	
	" estaria bueno que la responsabilidad de hacer el layoutSpec la tenga el morph que va a cambiar
	su layout spec"! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:32:10' prior: 50986486!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #purchaseHistoryDisplay indexGetter: #purchaseHistoryIndex indexSetter: #purchaseHistoryIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model purchaseHistoryTotal) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:33:50'!
purchaseHistoryDisplay

	^lastPurchaseHistoryRequest! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:33:52' prior: 50986535!
purchaseHistoryDisplay

	^lastPurchaseHistoryRequest.! !

!classDefinition: #TusLibrosLoginWindowModel category: 'TusLibros-Views' stamp: 'LNB 11/27/2021 23:34:08'!
Object subclass: #TusLibrosLoginWindowModel
	instanceVariableNames: 'username password restInterface cartId catalogueSelectionIndex cartSelectionIndex quantityToTransferTextBoxContents ticket ccn ccme ccye ticketSelectedIndex lastPurchaseHistoryRequest purchaseHistorySelectionIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:34:07'!
purchaseHistoryIndex

	^purchaseHistorySelectionIndex.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:34:31'!
purchaseHistoryIndex: aNewSelectionIndex

	purchaseHistorySelectionIndex _ aNewSelectionIndex.
	^true.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:35:07'!
purchaseHistoryTotal

	^purchaseHistorySelectionIndex at: 'total'.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:35:54' prior: 50986541!
purchaseHistoryDisplay

	| ticketForDisplay |
	ticketForDisplay _ lastPurchaseHistoryRequest copy.
	ticketForDisplay removeKey: 'total'.
	
	^ticketForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((ticketForDisplay at: aBookISBN) asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:36:01' prior: 50986579!
purchaseHistoryDisplay

	| purchaseHistoryForDisplay |
	purchaseHistoryForDisplay _ lastPurchaseHistoryRequest copy.
	purchaseHistoryForDisplay removeKey: 'total'.
	
	^purchaseHistoryForDisplay keys collect:[:aBookISBN | aBookISBN , ' | $' , ((purchaseHistoryForDisplay at: aBookISBN) asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:38:34' prior: 50986591!
purchaseHistoryDisplay

	| purchaseHistoryForDisplay |
	purchaseHistoryForDisplay _ lastPurchaseHistoryRequest copy.
	purchaseHistoryForDisplay removeKey: 'total'.
	
	^purchaseHistoryForDisplay keys collect:[:aBookISBN | aBookISBN , 
		' | amount:',
		' | $' , ((purchaseHistoryForDisplay at: aBookISBN) asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:39:53' prior: 50986604!
purchaseHistoryDisplay

	| purchaseHistoryForDisplay |
	purchaseHistoryForDisplay _ lastPurchaseHistoryRequest copy.
	purchaseHistoryForDisplay removeKey: 'total'.
	
	^purchaseHistoryForDisplay keys collect:[:aBookISBN | aBookISBN , 
		' | amount: ' , (((purchaseHistoryForDisplay at: aBookISBN) at: 'quantity') asString),
		' | $' , ((purchaseHistoryForDisplay at: aBookISBN) asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:40:07' prior: 50986618!
purchaseHistoryDisplay

	| purchaseHistoryForDisplay |
	purchaseHistoryForDisplay _ lastPurchaseHistoryRequest copy.
	purchaseHistoryForDisplay removeKey: 'total'.
	
	^purchaseHistoryForDisplay keys collect:[:aBookISBN | aBookISBN , 
		' | amount: ' , (((purchaseHistoryForDisplay at: aBookISBN) at: 'quantity') asString),
		' | $' , (((purchaseHistoryForDisplay at: aBookISBN) at: 'total') asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:40:22' prior: 50986634!
purchaseHistoryDisplay

	| purchaseHistoryForDisplay |
	purchaseHistoryForDisplay _ lastPurchaseHistoryRequest copy.
	purchaseHistoryForDisplay removeKey: 'total'.
	
	^purchaseHistoryForDisplay keys collect:[:aBookISBN | aBookISBN , 
		' | qty ' , (((purchaseHistoryForDisplay at: aBookISBN) at: 'quantity') asString),
		' | $' , (((purchaseHistoryForDisplay at: aBookISBN) at: 'total') asString)].
	! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:41:49' prior: 50986573!
purchaseHistoryTotal

	^lastPurchaseHistoryRequest at: 'total'.! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:43:15' prior: 50986235!
createNewWindowForPurchaseHistory
	
	TusLibrosClientPurchaseHistoryWindow openWithModel: self model.! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:43:40' prior: 50985778 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 0.
	cartSelectionIndex _ 0.
	
	quantityToTransferTextBoxContents _ ''.
	
	ticketSelectedIndex _ 0.
	
	purchaseHistorySelectionIndex _ 0.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current number asString.
	ccye _ GregorianYear current number asString.! !

TusLibrosClientMainWindow open.!
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:44:29' prior: 50986513!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #purchaseHistoryDisplay indexGetter: #purchaseHistoryIndex indexSetter: #purchaseHistoryIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model purchaseHistoryTotal asString) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).! !

!methodRemoval: TusLibrosClientPurchaseHistoryWindow #buildButtonsRow stamp: 'LNB 11/27/2021 23:45:20'!
buildButtonsRow

	| thirdColumnLayoutMorph createNewCartButton logOutButton listPurchasesButton |
	
	logOutButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #logOut label: 'Log out') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	createNewCartButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #createCart label: 'Create New Cart') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	listPurchasesButton _ ((PluggableButtonMorph model: self model stateGetter: nil action: #listPurchases label: 'List Purchases') borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec fixedWidth: 200 fixedHeight: 50).
	
	thirdColumnLayoutMorph _ LayoutMorph newRow.
	thirdColumnLayoutMorph axisEdgeWeight: 0.5;
	separation: 50;
	addMorph: logOutButton;
	addMorph: createNewCartButton;
	addMorph: listPurchasesButton.
	
	^thirdColumnLayoutMorph.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:53:29' prior: 50983386!
createCart

	[cartId _ restInterface createCartRequestFor: username with: password.] 
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #wrongUsernameOrPassword.].
	
	self triggerEvent: #cartCreationSuccesful.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:54:33' prior: 50981690!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #wrongUsernameOrPassword send: #displayWrongUsernameOrPasswordError to: self.
	
	self openInWorld.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:54:54'!
displayWrongUsernameOrPasswordError

	! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:57:29' prior: 50986790!
displayWrongUsernameOrPasswordError

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model withErrorMessage: self wrongUsernameOrPasswordErrorDescription.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:58:20' prior: 50986795!
displayWrongUsernameOrPasswordError

	TusLibrosClientCatalogAndCartContentsWindow openWithErrorMessage: self wrongUsernameOrPasswordErrorDescription.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/27/2021 23:59:19'!
wrongUsernameOrPasswordErrorDescription

	^'Username or password is incorrect.'! !

TusLibrosClientWindow subclass: #TusLibrosClientErrorWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

!classDefinition: #TusLibrosClientErrorWindow category: 'TusLibros-Views' stamp: 'LNB 11/28/2021 00:00:01'!
TusLibrosClientWindow subclass: #TusLibrosClientErrorWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!

TusLibrosClientErrorWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosClientErrorWindow class' category: 'TusLibros-Views' stamp: 'LNB 11/28/2021 00:00:01'!
TusLibrosClientErrorWindow class
	instanceVariableNames: ''!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:01'!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: 'Purchase History:') layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1);
	
	addMorph: ((PluggableListMorph model: self model listGetter: #purchaseHistoryDisplay indexGetter: #purchaseHistoryIndex indexSetter: #purchaseHistoryIndex:) borderWidth: 1; borderColor: Color black) layoutSpec: (LayoutSpec proportionalWidth: 1 proportionalHeight: 1);
	
	addMorph: (LabelMorph contents: 'Total: $' , model purchaseHistoryTotal asString) layoutSpec: (LayoutSpec proportionalWidth: 1 fixedHeight: 1).! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:01'!
createNewWindowForPurchaseHistory
	
	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:01'!
defaultExtent

	^ 1280@720
! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:01'!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:02'!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:02'!
logOut

	TusLibrosClientMainWindow open.
	self delete.! !
!TusLibrosClientErrorWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:02'!
openWithModel: aModel

	^self new initializeNamed: 'TusLibros - Client Window' modeledBy: aModel.! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:00:13' prior: 50986804!
displayWrongUsernameOrPasswordError

	TusLibrosClientErrorWindow openWithErrorMessage: self wrongUsernameOrPasswordErrorDescription.! !
!TusLibrosClientErrorWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:01:41'!
openWithErrorMessage: anErrorDescription

	^self new initializeNamed: 'TusLibros - ', anErrorDescription withMessageText: anErrorDescription.! !

!methodRemoval: TusLibrosClientErrorWindow class #openWithModel: stamp: 'LNB 11/28/2021 00:01:47'!
openWithModel: aModel

	^self new initializeNamed: 'TusLibros - Client Window' modeledBy: aModel.!
!TusLibrosClientErrorWindow class methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:02:20' prior: 50986919!
openWithErrorMessage: anErrorDescription

	^self new initializeNamed: 'TusLibros - Error' withMessageText: anErrorDescription.! !

!classDefinition: #TusLibrosClientErrorWindow category: 'TusLibros-Views' stamp: 'LNB 11/28/2021 00:03:13'!
TusLibrosClientWindow subclass: #TusLibrosClientErrorWindow
	instanceVariableNames: 'errorDescription'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Views'!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:03:11'!
initializeNamed: aTitle withMessageText: anErrorDescription

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	errorDescription _ anErrorDescription.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:04:40' prior: 50986869!
defaultExtent

	^ 500@200.
! !

!methodRemoval: TusLibrosClientErrorWindow #initializeNamed:modeledBy: stamp: 'LNB 11/28/2021 00:04:57'!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:06:42' prior: 50986971!
defaultExtent

	^ 250@100.
! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:09:37' prior: 50986839!
buildMorphicWindow

	self layoutMorph beColumn;
	color: Color red;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: errorDescription) layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:09:56' prior: 50986999!
buildMorphicWindow

	self layoutMorph beColumn;
	color: Color red;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: errorDescription) layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).! !

TusLibrosClientMainWindow open.!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:10:53' prior: 50986994!
defaultExtent

	^ 500@200.
! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:10:56' prior: 50987022!
defaultExtent

	^ 500@400.
! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:11:17' prior: 50987027!
defaultExtent

	^500@300.
	"^ 250@100."! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:13:15' prior: 50986762!
createCart

	[cartId _ restInterface createCartRequestFor: username with: password.
	self triggerEvent: #cartCreationSuccesful.] 
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #wrongUsernameOrPassword.].
	
	! !

TusLibrosClientMainWindow open.!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:14:09' prior: 50987032!
defaultExtent

	^5000@3000.
	"^ 250@100."! !

TusLibrosClientMainWindow open.!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:14:38' prior: 50987050!
defaultExtent

	^ 250@100.! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:14:52' prior: 50986951!
initializeNamed: aTitle withMessageText: anErrorDescription

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	errorDescription _ anErrorDescription.
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !

TusLibrosClientMainWindow open.!
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:15:37' prior: 50987010!
buildMorphicWindow

	self layoutMorph beColumn;
	separation: 50;
	axisEdgeWeight: 0;
	addMorph: (LabelMorph contents: errorDescription) layoutSpec: (LayoutSpec fixedWidth: 1 fixedHeight: 1).! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:15:47' prior: 50987061!
initializeNamed: aTitle withMessageText: anErrorDescription

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	errorDescription _ anErrorDescription.
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).
	self layoutMorph color: Color red.! !

TusLibrosClientMainWindow open.!
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:16:58' prior: 50985096!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:11' prior: 50986773!
initializeWith: aTitle

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #wrongUsernameOrPassword send: #displayWrongUsernameOrPasswordError to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientMainWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:14' prior: 50987131!
initializeWith: aTitle

	self setLabel: aTitle.
	self model: (TusLibrosLoginWindowModel new).
	
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #wrongUsernameOrPassword send: #displayWrongUsernameOrPasswordError to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:22' prior: 50986350!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:27' prior: 50987115!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:37' prior: 50987164!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:45' prior: 50986210!
initializeNamed: aTitle modeledBy: aModel

	"self titleMorph showButtonsNamed: #( close collapse )."
	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !

TusLibrosClientMainWindow open.!
!TusLibrosClientTicketDisplayWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:17:57' prior: 50987215!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientErrorWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:18:10' prior: 50987092!
initializeNamed: aTitle withMessageText: anErrorDescription

	self setLabel: aTitle.
	errorDescription _ anErrorDescription.
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).
	self layoutMorph color: Color red.! !

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:21:06' prior: 50985073!
checkoutCart

	[ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	self triggerEvent: #checkoutCartSuccess.]
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #checkoutCouldNotBePerformed.].! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:21:41' prior: 50987182!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	self model when: #checkoutCouldNotBePerformed send: #displaySaleTicketWindow to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:23:16' prior: 50987274!
checkoutCart

	[ticket _ restInterface checkoutCartRequestFor: cartId withCCN: ccn withCCME: ccme withCCYE: ccye withCCO: 'admin'.
	self triggerEvent: #checkoutCartSuccess.]
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #checkoutCouldNotBePerformed.].! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:23:18' prior: 50987287!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	self model when: #checkoutCouldNotBePerformed send: #displayCheckoutError to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:23:26'!
displayCheckoutError
	
	! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:24:02' prior: 50987334!
displayCheckoutError
	
	TusLibrosClientErrorWindow openWithErrorMessage: self checkoutErrorDescription.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:24:52'!
checkoutErrorDescription

	^'Could not perform checkout.'.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:24:54' prior: 50987346!
checkoutErrorDescription

	^'Could not perform checkout'.! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:27:28' prior: 50984272!
removeFromCart

	| bookISBN |
	[bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface removeFromCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartContentsModified.]
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #triedToRemoveTooManyItems.].! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:27:52' prior: 50987317!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	self model when: #checkoutCouldNotBePerformed send: #displayCheckoutError to: self.
	self model when: #triedToRemoveTooManyItems send: #displayRemoveError to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:28:09'!
displayRemoveError
	
	TusLibrosClientErrorWindow openWithErrorMessage: self removeErrorDescription.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:28:31'!
removeErrorDescription

	^'Tried to remove more items than currently found in cart'! !

TusLibrosClientMainWindow open.!
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:31:02' prior: 50984145!
addToCart

	| bookISBN |
	[bookISBN _ (restInterface listCatalog keys at: catalogueSelectionIndex).

	restInterface addToCartRequest: cartId for: bookISBN of: quantityToTransferTextBoxContents asNumber.
	
	self triggerEvent: #cartContentsModified.]
		on: Error - MessageNotUnderstood
		do: [:anError | self triggerEvent: #mustInputAValidQuantity.].! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:31:41' prior: 50986684 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 1.
	cartSelectionIndex _ 1.
	
	quantityToTransferTextBoxContents _ '1'.
	
	ticketSelectedIndex _ 0.
	
	purchaseHistorySelectionIndex _ 0.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current number asString.
	ccye _ GregorianYear current number asString.! !
!TusLibrosLoginWindowModel methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:31:52' prior: 50987426 overrides: 16896425!
initialize

	username _ ''.
	password _ ''.
	restInterface _ TusLibrosClientInterface new.
	
	catalogueSelectionIndex _ 1.
	cartSelectionIndex _ 1.
	
	quantityToTransferTextBoxContents _ '1'.
	
	ticketSelectedIndex _ 0.
	
	purchaseHistorySelectionIndex _ 0.
	
	"Cargamos un archivo encriptado con la tarjeta de credito del usuario"
	
	ccn _ '1234567890123456'.
	ccme _ GregorianMonth current number asString.
	ccye _ GregorianYear current number asString.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:32:43' prior: 50987375!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self model when: #cartContentsModified send: #updateCartContents to: self.
	self model when: #checkoutCartSuccess send: #displaySaleTicketWindow to: self.
	self model when: #checkoutCouldNotBePerformed send: #displayCheckoutError to: self.
	self model when: #triedToRemoveTooManyItems send: #displayRemoveError to: self.
	self model when: #mustInputAValidQuantity send: #displayInvalidQuantityError to: self.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:32:48'!
displayInvalidQuantityError! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:33:09' prior: 50987487!
displayInvalidQuantityError

	TusLibrosClientErrorWindow openWithErrorMessage: self invalidQuantityErrorDescription.! !
!TusLibrosClientCatalogAndCartContentsWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:33:31'!
invalidQuantityErrorDescription

	^'Quantity must be a valid number.'! !

TusLibrosClientMainWindow open.!

!methodRemoval: TusLibrosClientErrorWindow #createNewWindowForPurchaseHistory stamp: 'LNB 11/28/2021 00:37:42'!
createNewWindowForPurchaseHistory
	
	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.!

!methodRemoval: TusLibrosClientErrorWindow #displayCatalogAndCartContents stamp: 'LNB 11/28/2021 00:37:46'!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.!

!methodRemoval: TusLibrosClientErrorWindow #logOut stamp: 'LNB 11/28/2021 00:37:49'!
logOut

	TusLibrosClientMainWindow open.
	self delete.!

!methodRemoval: TusLibrosClientPurchaseHistoryWindow #logOut stamp: 'LNB 11/28/2021 00:38:43'!
logOut

	TusLibrosClientMainWindow open.
	self delete.!
!TusLibrosClientPurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 00:39:00' prior: 50987197!
initializeNamed: aTitle modeledBy: aModel

	self setLabel: aTitle.
	self model: aModel.
	
	self buildMorphicWindow.
	
	self openInWorld.
	self morphExtent: (self defaultExtent).! !

!methodRemoval: TusLibrosClientPurchaseHistoryWindow #displayCatalogAndCartContents stamp: 'LNB 11/28/2021 00:39:07'!
displayCatalogAndCartContents

	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.
	self delete.!

!methodRemoval: TusLibrosClientPurchaseHistoryWindow #createNewWindowForPurchaseHistory stamp: 'LNB 11/28/2021 00:39:23'!
createNewWindowForPurchaseHistory
	
	TusLibrosClientCatalogAndCartContentsWindow openWithModel: self model.!

----SNAPSHOT----(28 November 2021 00:39:34) CuisUniversity-4972.image priorSource: 20906505!

----SNAPSHOT----(28 November 2021 01:07:19) CuisUniversity-4972.image priorSource: 20988905!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosClientMainWindow methodsFor: 'error description' stamp: 'LNB 11/28/2021 01:34:38' prior: 50986812!
wrongUsernameOrPasswordErrorDescription

	^'Username or password is incorrect.
	Sos tremendo Gil!!'! !

TusLibrosClientMainWindow open.!
!TusLibrosClientMainWindow methodsFor: 'error description' stamp: 'LNB 11/28/2021 01:35:04' prior: 50987563!
wrongUsernameOrPasswordErrorDescription

	^'Username or password is incorrect.'! !

----STARTUP---- (28 November 2021 13:21:56) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!

!CartTest methodsFor: 'tests' stamp: 'LNB 11/28/2021 13:23:15'!
test11CannotAddNonIntegerAmountOfProducts

	| cart |

	cart := testObjectsFactory createCart.

	self 
		should: [cart add: 3.2 of: testObjectsFactory itemSellByTheStore]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: (cart occurrencesOf: testObjectsFactory itemSellByTheStore).
			].! !
!CartTest methodsFor: 'tests' stamp: 'LNB 11/28/2021 13:23:44'!
test12CannotRemoveNonIntegerAmountOfProducts

	| cart |

	cart := testObjectsFactory createCart.

	cart add: 2 of: testObjectsFactory itemSellByTheStore.
	
	self 
		should: [cart remove: 1.2 of: testObjectsFactory itemSellByTheStore]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 2 equals: (cart occurrencesOf: testObjectsFactory itemSellByTheStore).
			].! !

!testRun: #CartTest #test11CannotAddNonIntegerAmountOfProducts stamp: 'LNB 11/28/2021 13:24:15'!
FAILURE!

!testRun: #CartTest #test11CannotAddNonIntegerAmountOfProducts stamp: 'LNB 11/28/2021 13:24:15'!
FAILURE!
!Cart methodsFor: 'assertions' stamp: 'LNB 11/28/2021 13:25:35' prior: 50925487!
assertIsValidQuantity: aQuantity

	aQuantity strictlyPositive ifFalse: [self signalInvalidQuantity ].
	aQuantity isInteger ifFalse: [self signalInvalidQuantity ].! !

!testRun: #CartTest #test11CannotAddNonIntegerAmountOfProducts stamp: 'LNB 11/28/2021 13:25:47'!
FAILURE!
!CartTest methodsFor: 'tests' stamp: 'LNB 11/28/2021 13:26:02' prior: 50987564!
test11CannotAddNonIntegerAmountOfProducts

	| cart |

	cart := testObjectsFactory createCart.

	self 
		should: [cart add: 3.2 of: testObjectsFactory itemSellByTheStore]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [:anError |
			self assert: Cart invalidQuantityErrorMessage equals: anError messageText.
			self assert: 0 equals: (cart occurrencesOf: testObjectsFactory itemSellByTheStore).
			].! !

!testRun: #CartTest #test11CannotAddNonIntegerAmountOfProducts stamp: 'LNB 11/28/2021 13:26:09'!
PASSED!

!testRun: #CartTest #test12CannotRemoveNonIntegerAmountOfProducts stamp: 'LNB 11/28/2021 13:26:10'!
PASSED!
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 13:26:49' prior: 50983876!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'PUT'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 13:27:10' prior: 50984258!
listCartRequestFor: aCartId

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId }.
	
	resp _ WebClient htmlSubmit: (self url, '/listCart') fields: fieldDict method: 'GET'.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).]
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 13:27:31' prior: 50986191!
listPurchasesRequestFor: aUsername authenticatingWith: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/listPurchases') fields: fieldDict method: 'GET'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 13:27:40' prior: 50984284!
removeFromCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/removeFromCart') fields: fieldDict method: 'DELETE'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !

----QUIT----(28 November 2021 13:28:06) CuisUniversity-4972.image priorSource: 20988999!

----STARTUP---- (28 November 2021 13:28:11) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


----QUIT----(28 November 2021 13:28:33) CuisUniversity-4972.image priorSource: 20993604!

----STARTUP---- (28 November 2021 13:36:38) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:22:51'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

TusLibrosServerQueueingInterface class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosServerQueueingInterface class' category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:22:51'!
TusLibrosServerQueueingInterface class
	instanceVariableNames: ''!
!TusLibrosServerQueueingInterface methodsFor: 'enabling services' stamp: 'LNB 11/28/2021 16:22:51'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:22:51'!
addService: anEndpoint action: anActionBlock

	webServer 
		addService: anEndpoint 
		action: [ :request |
			[ anActionBlock value: request ] 
			on: Error
			do: [ :anError |
				request send400Response: anError messageText.]]! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:22:51'!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:22:52'!
port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ systemFacade createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ systemFacade listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:22:52'!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers - private' stamp: 'LNB 11/28/2021 16:22:52'!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).].
	
	purchasesDictionary at: 'total' put: purchases total.
	
	^ WebUtils jsonEncode: purchasesDictionary.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers - private' stamp: 'LNB 11/28/2021 16:22:52'!
serializeTicket: aTicket

	| ticketDictionary |
	ticketDictionary _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | ticketDictionary at: aLineItem item put: aLineItem total ].
	ticketDictionary at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: ticketDictionary.! !
!TusLibrosServerQueueingInterface class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 16:22:52'!
listeningOn: aPortNumber interactingWith: aTusLibrosSystemFacade

	^self new initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade.! !

Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'webServer port systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:23:50'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'webServer port systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

TusLibrosServerRequestHandler class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosServerRequestHandler class' category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:23:50'!
TusLibrosServerRequestHandler class
	instanceVariableNames: ''!
!TusLibrosServerRequestHandler methodsFor: 'enabling services' stamp: 'LNB 11/28/2021 16:23:50'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:23:50'!
addService: anEndpoint action: anActionBlock

	webServer 
		addService: anEndpoint 
		action: [ :request |
			[ anActionBlock value: request ] 
			on: Error
			do: [ :anError |
				request send400Response: anError messageText.]]! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:23:50'!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:23:50'!
port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:50'!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:50'!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:50'!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ systemFacade createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:51'!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:51'!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ systemFacade listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:51'!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 16:23:51'!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers - private' stamp: 'LNB 11/28/2021 16:23:51'!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).].
	
	purchasesDictionary at: 'total' put: purchases total.
	
	^ WebUtils jsonEncode: purchasesDictionary.! !
!TusLibrosServerRequestHandler methodsFor: 'request handlers - private' stamp: 'LNB 11/28/2021 16:23:51'!
serializeTicket: aTicket

	| ticketDictionary |
	ticketDictionary _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | ticketDictionary at: aLineItem item put: aLineItem total ].
	ticketDictionary at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: ticketDictionary.! !
!TusLibrosServerRequestHandler class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 16:23:51'!
listeningOn: aPortNumber interactingWith: aTusLibrosSystemFacade

	^self new initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade.! !

!classRenamed: #TusLibrosServerInterface as: #TusLibrosServerSynchronousInterface stamp: 'LNB 11/28/2021 16:24:09'!
Smalltalk renameClassNamed: #TusLibrosServerInterface as: #TusLibrosServerSynchronousInterface!

Object subclass: #TusLibrosServerAsynchronousInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerAsynchronousInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:25:55'!
Object subclass: #TusLibrosServerAsynchronousInterface
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRenamed: #TusLibrosServerAsynchronousInterface as: #TusLibrosAsynchronousServer stamp: 'LNB 11/28/2021 16:26:24'!
Smalltalk renameClassNamed: #TusLibrosServerAsynchronousInterface as: #TusLibrosAsynchronousServer!

!classRenamed: #TusLibrosServerSynchronousInterface as: #TusLibrosSynchronousServerInterface stamp: 'LNB 11/28/2021 16:26:41'!
Smalltalk renameClassNamed: #TusLibrosServerSynchronousInterface as: #TusLibrosSynchronousServerInterface!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:29:52'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:29:53'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:29:55'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'nil' stamp: 'LNB 11/28/2021 16:29:44' overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 interactingWith: facade.
	requestHandlers _ OrderedCollection new.! !

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:31:23'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers queue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:31:04' prior: 50988210 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	queue _ OrderedCollection new.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 interactingWith: facade.
	requestHandlers _ OrderedCollection new.! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:31:41' prior: 50988232 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	queue _ OrderedCollection new.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 interactingWith: queue.
	requestHandlers _ OrderedCollection new.! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:34:10'!
forkNewRequestHandler

	requestHandlers _ OrderedCollection new.! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:35:14' prior: 50988258!
forkNewRequestHandler

	requestHandlers add: (TusLibrosServerRequestHandler listeningOn: queue interactingWith: facade).! !
!TusLibrosServerQueueingInterface class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 16:36:06' prior: 50987926!
listeningOn: aPortNumber interactingWith: aQueue

	^self new initializeWith: aPortNumber interactingWith: aQueue.! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 16:36:36' prior: 50987756!
initializeWith: aPortNumber interactingWith: aQueue
	
	systemFacade := aQueue.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 16:36:40'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port queue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987868!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ queue listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987859!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ queue listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987847!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ queue listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987833!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ queue createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987882!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	queue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987793!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50987807!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ queue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 16:36:40' prior: 50988280!
initializeWith: aPortNumber interactingWith: aQueue
	
	queue := aQueue.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 17:00:12' prior: 50988382!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	aRequest send200Response: 'OK'.
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}. 
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.}.
			
	queue addLast: requestDictionary.
	! !

Beeper beepPrimitive!
!TusLibrosClientErrorWindow methodsFor: 'initialization' stamp: 'LNB 11/28/2021 17:05:18' prior: 50987252!
initializeNamed: aTitle withMessageText: anErrorDescription

	self setLabel: aTitle.
	errorDescription _ anErrorDescription.
	self buildMorphicWindow.
	
	self model when: #cartCreationSuccesful send: #displayCatalogAndCartContents to: self.
	self model when: #succesfullyLoggedOut send: #logOut to: self.
	self model when: #purchaseHistoryArrived send: #createNewWindowForPurchaseHistory to: self.
	
	self openInWorld.
	Beeper beepPrimitive.
	self morphExtent: (self defaultExtent).
	self layoutMorph color: Color red.! !

	Beeper beepPrimitive.!
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 17:10:48' prior: 50988450!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary semaphoreWaitUntilDone |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	aRequest send200Response: 'OK'.
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}. 
	semaphoreWaitUntilDone _ Semaphore.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			'semaphore'. Semaphore}.
			
	queue addLast: requestDictionary.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 17:34:50' prior: 50988423!
initializeWith: aPortNumber interactingWith: aQueue
	
	queue := aQueue.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:37:59'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers queue queueSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:37:54' prior: 50988246 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	queue _ OrderedCollection new.
	queueSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 interactingWith: queue.
	requestHandlers _ OrderedCollection new.! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:38:25' prior: 50988558 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	queue _ OrderedCollection new.
	queueSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 interactingWith: queue waitingOn: queueSemaphore.
	requestHandlers _ OrderedCollection new.! !
!TusLibrosServerQueueingInterface class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 17:38:50'!
listeningOn: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore

	^self new initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore.! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:39:29'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port queue queueSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 17:39:26'!
initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore
	
	queue := aQueue.
	queueSemaphore _ aQueueSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!methodRemoval: TusLibrosServerQueueingInterface #initializeWith:interactingWith: stamp: 'LNB 11/28/2021 17:39:35'!
initializeWith: aPortNumber interactingWith: aQueue
	
	queue := aQueue.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:50:01'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers queue queueSemaphore requestQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:50:02'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers queue queueSemaphore requestQueue handlerQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:50:03'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers queue queueSemaphore requestQueue handlerQueue waitForHandlerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:49:57' prior: 50988573 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	requestQueue _ SharedQueue new.
	handlerQueue _ SharedQueue new. 
	waitForHandlerSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 addingRequestsTo: requestQueue gettingResponseQueuesFrom: handlerQueue withMutexSemaphore: waitForHandlerSemaphore.
	requestHandlers _ OrderedCollection new.! !

Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers requestQueue handlerQueue waitForHandlerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:51:09'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers requestQueue handlerQueue waitForHandlerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:51:25'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers requestsQueue handlerQueue waitForHandlerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:51:26' prior: 50988698 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	requestsQueue _ SharedQueue new.
	handlerQueue _ SharedQueue new. 
	waitForHandlerSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 addingRequestsTo: requestsQueue gettingResponseQueuesFrom: handlerQueue withMutexSemaphore: waitForHandlerSemaphore.
	requestHandlers _ OrderedCollection new.! !

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:51:32'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers requestsQueue handlersQueue waitForHandlerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:51:32' prior: 50988747 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	requestsQueue _ SharedQueue new.
	handlersQueue _ SharedQueue new. 
	waitForHandlerSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 addingRequestsTo: requestsQueue gettingResponseQueuesFrom: handlersQueue withMutexSemaphore: waitForHandlerSemaphore.
	requestHandlers _ OrderedCollection new.! !

!classDefinition: #TusLibrosAsynchronousServer category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:53:10'!
Object subclass: #TusLibrosAsynchronousServer
	instanceVariableNames: 'facade queueingInterface requestHandlers requestsQueue handlersQueue waitForHandlerSemaphore waitForQueuerSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:52:59' prior: 50988777 overrides: 16896425!
initialize
	
	| factory |
	factory _ InterfaceTestObjectsFactory new.
	
	requestsQueue _ SharedQueue new.
	handlersQueue _ SharedQueue new. 
	waitForHandlerSemaphore _ Semaphore forMutualExclusion.
	waitForQueuerSemaphore _ Semaphore forMutualExclusion.
	
	facade _ factory createSystemFacade.
	queueingInterface _ TusLibrosServerQueueingInterface listeningOn: 8080 addingRequestsTo: requestsQueue gettingResponseQueuesFrom: handlersQueue withMutexSemaphore: waitForHandlerSemaphore.
	requestHandlers _ OrderedCollection new.! !

!methodRemoval: TusLibrosServerQueueingInterface class #listeningOn:interactingWith: stamp: 'LNB 11/28/2021 17:54:04'!
listeningOn: aPortNumber interactingWith: aQueue

	^self new initializeWith: aPortNumber interactingWith: aQueue.!
!TusLibrosServerQueueingInterface class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 17:55:29'!
listeningOn: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore

	^self new initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore.! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 17:55:57'!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	queue := aRequestsQueue.
	queueSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:56:06'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port requestsQueue queueSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:06' prior: 50988331!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ requestsQueue listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:06' prior: 50988606!
initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore
	
	requestsQueue := aQueue.
	queueSemaphore _ aQueueSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:06' prior: 50988849!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	queueSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:06' prior: 50988341!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ requestsQueue listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:06' prior: 50988368!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	requestsQueue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:07' prior: 50988354!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ requestsQueue createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:07' prior: 50988494!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary semaphoreWaitUntilDone |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	aRequest send200Response: 'OK'.
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}. 
	semaphoreWaitUntilDone _ Semaphore.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			'semaphore'. Semaphore}.
			
	requestsQueue addLast: requestDictionary.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:07' prior: 50988396!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:07' prior: 50988316!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:56:20'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port requestsQueue queueSemaphore handlersQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 17:56:18' prior: 50988933!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queueSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:56:48'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port requestsQueue handlerSemaphore handlersQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:48' prior: 50988902!
initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore
	
	requestsQueue := aQueue.
	handlerSemaphore _ aQueueSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:56:48' prior: 50989085!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	handlerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!classDefinition: #TusLibrosServerQueueingInterface category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 17:57:06'!
Object subclass: #TusLibrosServerQueueingInterface
	instanceVariableNames: 'webServer port requestsQueue queuerSemaphore handlersQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:57:06' prior: 50989130!
initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore
	
	requestsQueue := aQueue.
	queuerSemaphore _ aQueueSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 17:57:06' prior: 50989161!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queuerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	! !

!methodRemoval: TusLibrosServerQueueingInterface #initializeWith:interactingWith:waitingOn: stamp: 'LNB 11/28/2021 17:57:21'!
initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore
	
	requestsQueue := aQueue.
	queuerSemaphore _ aQueueSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [[ :request | self createCart: request ] fork ].
	self addService: '/listCatalog' action: [[ :request | self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [[ :request | self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [[ :request | self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [[ :request | self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [[ :request | self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [[ :request | self listPurchases: request ] fork ].
	!
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 17:57:41' prior: 50989008!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary semaphoreWaitUntilDone |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	aRequest send200Response: 'OK'.
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}. 
	semaphoreWaitUntilDone _ Semaphore.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	requestsQueue addLast: requestDictionary.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 17:58:08' prior: 50989302!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	aRequest send200Response: 'OK'.
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
	
	requestsQueue addLast: requestDictionary.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:01:56' prior: 50989326!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary handlersResponseQueue response |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	queuerSemaphore wait.
	requestsQueue nextPut: requestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	response _ handlersResponseQueue next.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:03:08' prior: 50989033!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
									
	
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:05:53' prior: 50989376!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson argArray handlersResponseQueue requestDictionary response |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
									
	argArray _ 
		{cartId asNumber . 
		creditCardNumber . 
		creditCardOwner . 
		(GregorianMonthOfYear 
			yearNumber: yearExpiration asNumber 
			monthNumber: monthExpiration asNumber)}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: . 
			'args'. argArray.
			}.
			
	queuerSemaphore wait.
	requestsQueue nextPut: requestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	response _ handlersResponseQueue next.
	ticket _ response.
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:08:42' prior: 50988994!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray handlersResponseQueue requestDictionary response |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #createCartFor:authenticatedWith: . 
			'args'. argArray.
			}.
			
	queuerSemaphore wait.
	requestsQueue nextPut: requestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	response _ handlersResponseQueue next.
	cartId _ response.
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:12:53' prior: 50989060!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson argArray handlersResponseQueue requestDictionary response |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password."
	
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listPurchasesOf:authenticatingWith: . 
			'args'. argArray.
			}.
			
	queuerSemaphore wait.
	requestsQueue nextPut: requestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	response _ handlersResponseQueue next.
	purchases _ response.
	
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:14:47'!
requestToHandlers: aRequestDictionary		
	| handlersResponseQueue |
	queuerSemaphore wait.
	requestsQueue nextPut: aRequestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	^handlersResponseQueue next.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:14:53' prior: 50989505!
requestToHandlers: aRequestDictionary		

	| handlersResponseQueue |
	
	queuerSemaphore wait.
	requestsQueue nextPut: aRequestDictionary.
	handlersResponseQueue _ handlersQueue next.
	queuerSemaphore signal.
	^handlersResponseQueue next.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:15:28' prior: 50989348!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:15:53' prior: 50989403!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson argArray requestDictionary |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
									
	argArray _ 
		{cartId asNumber . 
		creditCardNumber . 
		creditCardOwner . 
		(GregorianMonthOfYear 
			yearNumber: yearExpiration asNumber 
			monthNumber: monthExpiration asNumber)}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: . 
			'args'. argArray.
			}.
			
	ticket _ self requestToHandlers: requestDictionary.
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:16:13' prior: 50989449!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray requestDictionary |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #createCartFor:authenticatedWith: . 
			'args'. argArray.
			}.
			
	cartId _ self requestToHandlers: requestDictionary..
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:16:18' prior: 50989593!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray requestDictionary |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #createCartFor:authenticatedWith: . 
			'args'. argArray.
			}.
			
	cartId _ self requestToHandlers: requestDictionary.
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:16:35' prior: 50989477!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson argArray requestDictionary |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password."
	
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listPurchasesOf:authenticatingWith: . 
			'args'. argArray.
			}.
			
	purchases _ self requestToHandlers: requestDictionary.
	
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:18:48' prior: 50988967!
listCart: aRequest

	| cartId cartContents contentsAsJson argArray requestDictionary |
	cartId _ aRequest fields at: 'cartId'.
	"cartContents _ requestsQueue listCartIdentifiedAs: cartId asNumber."
	
	argArray _ {cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	cartContents _ self requestToHandlers: requestDictionary.
	
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !

Object new perform: #print withArguments: {}!

Object new perform: #print withArguments: {}!
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:20:36' prior: 50988892!
listCatalog: aRequest

	| catalog catalogAsJson argArray requestDictionary |
	"catalog _ requestsQueue listCatalog."
	
	argArray _ {}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listCatalog . 
			'args'. argArray.
			}.
			
	catalog _ self requestToHandlers: requestDictionary.
	
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:21:51' prior: 50988980!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"requestsQueue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #remove:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.

	! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 18:28:28' prior: 50988264!
forkNewRequestHandler

	| newRequestHandler |
	newRequestHandler _ requestHandlers 
		add: (TusLibrosServerRequestHandler 
			listeningRequestsFrom: requestsQueue 
			answeringWithQueueOn: handlersQueue 
			withMutexSemaphore: waitForQueuerSemaphore 
			handlingRequestsWith: facade).
			
	[newRequestHandler startHandlingRequests] fork.! !
!TusLibrosServerRequestHandler class methodsFor: 'instance creation' stamp: 'LNB 11/28/2021 18:31:05'!
listeningRequestsFrom: aRequestsQueue answeringWithQueueOn: aHandlersQueue withMutexSemaphore: aHandlersSemaphore handlingRequestsWith: aFacade

	^self new initializeWith: aFacade listeningRequestsFrom: aRequestsQueue answeringWithQueueOn: aHandlersQueue withMutexSemaphore: aHandlersSemaphore.! !

!methodRemoval: TusLibrosServerRequestHandler class #listeningOn:interactingWith: stamp: 'LNB 11/28/2021 18:31:10'!
listeningOn: aPortNumber interactingWith: aTusLibrosSystemFacade

	^self new initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade.!

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 18:32:55'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'webServer port systemFacade requestsQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 18:32:56'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'webServer port systemFacade requestsQueue handlersQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 18:32:57'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'webServer port systemFacade requestsQueue handlersQueue handlersSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:32:53'!
initializeWith: aTusLibrosSystemFacade listeningRequestsFrom: aRequestsQueue answeringWithQueueOn: aHandlersQueue withMutexSemaphore: aHandlersSemaphore
	
	systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore.
	
	! !

Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'systemFacade requestsQueue handlersQueue handlersSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 18:33:06'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'systemFacade requestsQueue handlersQueue handlersSemaphore'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!methodRemoval: TusLibrosServerQueueingInterface class #listeningOn:interactingWith:waitingOn: stamp: 'LNB 11/28/2021 18:33:24'!
listeningOn: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore

	^self new initializeWith: aPortNumber interactingWith: aQueue waitingOn: aQueueSemaphore.!

!methodRemoval: TusLibrosServerRequestHandler #initializeWith:interactingWith: stamp: 'LNB 11/28/2021 18:33:33'!
initializeWith: aPortNumber interactingWith: aTusLibrosSystemFacade
	
	systemFacade := aTusLibrosSystemFacade.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	!

!methodRemoval: TusLibrosServerRequestHandler #port stamp: 'LNB 11/28/2021 18:33:40'!
port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].!

!methodRemoval: TusLibrosServerRequestHandler #removeFromCart: stamp: 'LNB 11/28/2021 18:33:42'!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.

	!

!methodRemoval: TusLibrosServerRequestHandler #serializePurchases: stamp: 'LNB 11/28/2021 18:33:43'!
serializePurchases: purchases

	| purchasesDictionary |
	purchasesDictionary _ Dictionary new.
	
	purchases itemsDo: [ :anItem | | lineItem |
		lineItem _ purchases at: anItem.
		purchasesDictionary 
			at: anItem 
			put: (Dictionary newFromPairs: { 'total'. lineItem total. 'quantity'. lineItem quantity. }).].
	
	purchasesDictionary at: 'total' put: purchases total.
	
	^ WebUtils jsonEncode: purchasesDictionary.!

!methodRemoval: TusLibrosServerRequestHandler #serializeTicket: stamp: 'LNB 11/28/2021 18:33:45'!
serializeTicket: aTicket

	| ticketDictionary |
	ticketDictionary _ Dictionary new.
	
	aTicket lineItemsDo: [ :aLineItem | ticketDictionary at: aLineItem item put: aLineItem total ].
	ticketDictionary at: 'total' put: aTicket total.
	
	^ WebUtils jsonEncode: ticketDictionary.!

!methodRemoval: TusLibrosServerRequestHandler #listPurchases: stamp: 'LNB 11/28/2021 18:33:46'!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	purchases _ systemFacade listPurchasesOf: clientId authenticatingWith: password.
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.!

!methodRemoval: TusLibrosServerRequestHandler #listCatalog: stamp: 'LNB 11/28/2021 18:33:48'!
listCatalog: aRequest

	| catalog catalogAsJson |
	catalog _ systemFacade listCatalog.
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.!

!methodRemoval: TusLibrosServerRequestHandler #listCart: stamp: 'LNB 11/28/2021 18:33:50'!
listCart: aRequest

	| cartId cartContents contentsAsJson |
	cartId _ aRequest fields at: 'cartId'.
	cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.!

!methodRemoval: TusLibrosServerRequestHandler #destroy stamp: 'LNB 11/28/2021 18:33:51'!
destroy
	
	webServer ifNotNil:[webServer destroy].!

!methodRemoval: TusLibrosServerRequestHandler #createCart: stamp: 'LNB 11/28/2021 18:33:53'!
createCart: aRequest

	| cartId cartIdAsJson clientId password |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	cartId _ systemFacade createCartFor: clientId authenticatedWith: password.
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.!

!methodRemoval: TusLibrosServerRequestHandler #checkoutCart: stamp: 'LNB 11/28/2021 18:33:54'!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	ticket _ systemFacade checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber).
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.!

!methodRemoval: TusLibrosServerRequestHandler #addToCart: stamp: 'LNB 11/28/2021 18:33:56'!
addToCart: aRequest

	| bookISBN bookQuantity cartId |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	systemFacade add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber.
	aRequest send200Response: 'OK'.!

!methodRemoval: TusLibrosServerRequestHandler #addService:action: stamp: 'LNB 11/28/2021 18:33:57'!
addService: anEndpoint action: anActionBlock

	webServer 
		addService: anEndpoint 
		action: [ :request |
			[ anActionBlock value: request ] 
			on: Error
			do: [ :anError |
				request send400Response: anError messageText.]]!
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:35:31'!
startHandlingRequests

	true whileTrue: [
		self handleOneRequest.
		].! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:36:48'!
handleOneRequest

	| requestDictionary |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	systemFacade re.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:37:40' prior: 50990013!
handleOneRequest

	| requestDictionary |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	systemFacade perform: (requestDictionary at: 1) withArguments: (requestDictionary at: 2).
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:38:53' prior: 50989529!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #add:of:toCartIdentifiedAs:.
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #add:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:39:05' prior: 50990041!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #add:of:toCartIdentifiedAs:.
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. messageSymbol . 
			'args'. argArray.
			}.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:39:50'!
createRequestDictionaryFor: messageSymbol andArgumentIn: argArray

	^ Dictionary 
		newFromPairs: {
			'message'. messageSymbol . 
			'args'. argArray.
			}! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:39:50' prior: 50990065!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #add:of:toCartIdentifiedAs:.
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:40:18' prior: 50989552!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
		
	messageSymbol _ #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: .
	argArray _ 
		{cartId asNumber . 
		creditCardNumber . 
		creditCardOwner . 
		(GregorianMonthOfYear 
			yearNumber: yearExpiration asNumber 
			monthNumber: monthExpiration asNumber)}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: . 
			'args'. argArray.
			}.
			
	ticket _ self requestToHandlers: requestDictionary.
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:40:40' prior: 50989616!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	messageSymbol _ #createCartFor:authenticatedWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #createCartFor:authenticatedWith: . 
			'args'. argArray.
			}.
			
	cartId _ self requestToHandlers: requestDictionary.
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:40:56' prior: 50989662!
listCart: aRequest

	| cartId cartContents contentsAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	"cartContents _ requestsQueue listCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #listCartIdentifiedAs: .
	argArray _ {cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	cartContents _ self requestToHandlers: requestDictionary.
	
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:41:12' prior: 50989685!
listCatalog: aRequest

	| catalog catalogAsJson argArray requestDictionary messageSymbol |
	"catalog _ requestsQueue listCatalog."
	
	messageSymbol _ #listCatalog.
	argArray _ {}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listCatalog . 
			'args'. argArray.
			}.
			
	catalog _ self requestToHandlers: requestDictionary.
	
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:41:45' prior: 50989639!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password."
	
	messageSymbol _ #listPurchasesOf:authenticatingWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #listPurchasesOf:authenticatingWith: . 
			'args'. argArray.
			}.
			
	purchases _ self requestToHandlers: requestDictionary.
	
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:41:59' prior: 50989702!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"requestsQueue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #remove:of:toCartIdentifiedAs: .
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	Dictionary 
		newFromPairs: {
			'message'. #remove:of:toCartIdentifiedAs: . 
			'args'. argArray.
			}.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:42:22' prior: 50990120!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
		
	messageSymbol _ #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: .
	argArray _ 
		{cartId asNumber . 
		creditCardNumber . 
		creditCardOwner . 
		(GregorianMonthOfYear 
			yearNumber: yearExpiration asNumber 
			monthNumber: monthExpiration asNumber)}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	ticket _ self requestToHandlers: requestDictionary.
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:42:27' prior: 50990164!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	messageSymbol _ #createCartFor:authenticatedWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	cartId _ self requestToHandlers: requestDictionary.
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:42:43' prior: 50990088!
createRequestDictionaryFor: aMessageSymbol andArgumentIn: argArray

	^ Dictionary 
		newFromPairs: {
			'message'. aMessageSymbol . 
			'args'. argArray.
			}! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:42:47' prior: 50990346!
createRequestDictionaryFor: aMessageSymbol andArgumentIn: anArgArray

	^ Dictionary 
		newFromPairs: {
			'message'. aMessageSymbol . 
			'args'. anArgArray.
			}! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:42:57' prior: 50990189!
listCart: aRequest

	| cartId cartContents contentsAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	"cartContents _ requestsQueue listCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #listCartIdentifiedAs: .
	argArray _ {cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	cartContents _ self requestToHandlers: requestDictionary.
	
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:43:04' prior: 50990211!
listCatalog: aRequest

	| catalog catalogAsJson argArray requestDictionary messageSymbol |
	"catalog _ requestsQueue listCatalog."
	
	messageSymbol _ #listCatalog.
	argArray _ {}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	catalog _ self requestToHandlers: requestDictionary.
	
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:43:10' prior: 50990229!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password."
	
	messageSymbol _ #listPurchasesOf:authenticatingWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	purchases _ self requestToHandlers: requestDictionary.
	
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 18:43:16' prior: 50990255!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"requestsQueue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #remove:of:toCartIdentifiedAs: .
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentIn: argArray.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:43:36'!
handleARequest

	| requestDictionary |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	systemFacade perform: (requestDictionary at: 1) withArguments: (requestDictionary at: 2).
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerRequestHandler methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 18:43:36' prior: 50990007!
startHandlingRequests

	true whileTrue: [
		self handleARequest.
		].! !

!methodRemoval: TusLibrosServerRequestHandler #handleOneRequest stamp: 'LNB 11/28/2021 18:43:36'!
handleOneRequest

	| requestDictionary |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	systemFacade perform: (requestDictionary at: 1) withArguments: (requestDictionary at: 2).
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	!
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:43:59' prior: 50990449!
handleARequest

	| requestDictionary |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 18:47:25' prior: 50990484!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue _ self privateResponsesQueue.
	response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !

!classDefinition: #TusLibrosServerRequestHandler category: #'TusLibros-Model' stamp: 'LNB 11/28/2021 18:47:54'!
Object subclass: #TusLibrosServerRequestHandler
	instanceVariableNames: 'systemFacade requestsQueue handlersQueue handlersSemaphore privateResponseQueue'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServerRequestHandler methodsFor: 'initialization' stamp: 'LNB 11/28/2021 18:47:50' prior: 50989790!
initializeWith: aTusLibrosSystemFacade listeningRequestsFrom: aRequestsQueue answeringWithQueueOn: aHandlersQueue withMutexSemaphore: aHandlersSemaphore
	
	systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore.
	
	privateResponseQueue _ SharedQueue new.
	
	! !
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 18:50:24' prior: 50990500!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: self privateResponsesQueue.
	handlersSemaphore signal.
	
	response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport.!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport.!

TusLibrosSynchronousServerInterface allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

TusLibrosClientMainWindow open.!

asynchronousServer forkNewRequestHandler.!
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 18:55:28' prior: 50990464!
startHandlingRequests

	[true] whileTrue: [
		self handleARequest.
		].! !

asynchronousServer _ TusLibrosAsynchronousServer new.!

TusLibrosClientMainWindow open.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

factory _ InterfaceTestObjectsFactory new.!

server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosSynchronousServerInterface allInstances.!

Utilities garbageCollectAndReport.!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosClientMainWindow open.!

----QUIT----(28 November 2021 19:12:51) CuisUniversity-4972.image priorSource: 20993841!

----STARTUP---- (28 November 2021 19:14:37) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


asynchronousServer _ TusLibrosAsynchronousServer new.!

TusLibrosSynchronousServerInterface allInstances!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:18:10'!
destroy
	
	queueingInterface destroy.! !
!TusLibrosAsynchronousServer methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:18:33' prior: 50990627!
destroy
	
	queueingInterface ifNotNil:[queueingInterface destroy].! !

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport !

TusLibrosAsynchronousServer allInstances !

TusLibrosSynchronousServerInterface allInstances!

TusLibrosClientMainWindow open.!

Utilities garbageCollectAndReport !

TusLibrosSynchronousServerInterface allInstances!

TusLibrosAsynchronousServer allInstances!

TusLibrosClientMainWindow open.!
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 19:34:03' prior: 50983741!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	self halt
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientMainWindow open.!
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 19:34:18' prior: 50990654!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	self halt.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !

----QUIT----(28 November 2021 19:36:35) CuisUniversity-4972.image priorSource: 21086652!

----STARTUP---- (28 November 2021 19:36:55) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


UndefinedObject allInstances!

factory _ InterfaceTestObjectsFactory new.!

server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientMainWindow open.!

----QUIT----(28 November 2021 19:40:43) CuisUniversity-4972.image priorSource: 21089310!

----STARTUP---- (28 November 2021 19:40:53) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!

!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 19:41:09' prior: 50990674!
createCartRequestFor: aUsername with: aPassword

	" un username no deberia tener espacios, todo: chequear que eso no suceda"
	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'clientId'. aUsername. 'password'. aPassword }.
	
	resp _ WebClient htmlSubmit: (self url, '/createCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)).] 
        		ifFalse:[^self error: resp content].! !

----QUIT----(28 November 2021 19:41:28) CuisUniversity-4972.image priorSource: 21089767!

----STARTUP---- (28 November 2021 19:41:30) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientMainWindow open.!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosSynchronousServerInterface allInstances.!

Utilities garbageCollectAndReport.!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosAsynchronousServer allInstances.!

factory _ InterfaceTestObjectsFactory new.!

server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientMainWindow open.!

----QUIT----(28 November 2021 19:51:13) CuisUniversity-4972.image priorSource: 21090578!

----STARTUP---- (28 November 2021 19:51:19) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

factory _ InterfaceTestObjectsFactory new.!

server _ TusLibrosSynchronousServerInterface listeningOn: 8080 interactingWith: factory createSystemFacade.!

TusLibrosClientMainWindow open.!

TusLibrosAsynchronousServer allInstances.!

TusLibrosSynchronousServerInterface allInstances.!

Utilities garbageCollectAndReport!

TusLibrosSynchronousServerInterface allInstances.!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport.!

TusLibrosSynchronousServerInterface allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

TusLibrosClientMainWindow open.!

asynchronousServer forkNewRequestHandler.!

TusLibrosSynchronousServerInterface allInstances do: [ :aServer | aServer destroy ].!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

TusLibrosSynchronousServerInterface allInstances.!

----QUIT----(28 November 2021 19:55:46) CuisUniversity-4972.image priorSource: 21091499!

----STARTUP---- (28 November 2021 19:55:48) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!
!TusLibrosServerQueueingInterface methodsFor: 'request handlers' stamp: 'LNB 11/28/2021 19:57:24'!
createRequestDictionaryFor: aMessageSymbol andArgumentsIn: anArgArray

	^ Dictionary 
		newFromPairs: {
			'message'. aMessageSymbol . 
			'args'. anArgArray.
			}! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:24' prior: 50990385!
listCatalog: aRequest

	| catalog catalogAsJson argArray requestDictionary messageSymbol |
	"catalog _ requestsQueue listCatalog."
	
	messageSymbol _ #listCatalog.
	argArray _ {}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	catalog _ self requestToHandlers: requestDictionary.
	
	catalogAsJson _ WebUtils jsonEncode: catalog.
	aRequest send200Response: catalogAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:24' prior: 50990097!
addToCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"queue add: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #add:of:toCartIdentifiedAs:.
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.
	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:25' prior: 50990402!
listPurchases: aRequest

	| clientId password purchases purchasesAsJson argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"purchases _ requestsQueue listPurchasesOf: clientId authenticatingWith: password."
	
	messageSymbol _ #listPurchasesOf:authenticatingWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	purchases _ self requestToHandlers: requestDictionary.
	
	purchasesAsJson _ self serializePurchases: purchases.
	aRequest send200Response: purchasesAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:25' prior: 50990280!
checkoutCart: aRequest

	| cartId creditCardNumber monthExpiration yearExpiration creditCardOwner ticket ticketAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	creditCardNumber _ aRequest fields at: 'ccn'.
	monthExpiration _ aRequest fields at: 'ccme'.
	yearExpiration _ aRequest fields at: 'ccye'.
	creditCardOwner _ aRequest fields at: 'cco'.
	
	"ticket _ requestsQueue checkOutCartIdentifiedAs: cartId asNumber
					    withCreditCardNumbered: creditCardNumber 
					    ownedBy: creditCardOwner 
					    expiringOn: (GregorianMonthOfYear 
									yearNumber: yearExpiration asNumber 
									monthNumber: monthExpiration asNumber)."
		
	messageSymbol _ #checkOutCartIdentifiedAs:withCreditCardNumbered:ownedBy:expiringOn: .
	argArray _ 
		{cartId asNumber . 
		creditCardNumber . 
		creditCardOwner . 
		(GregorianMonthOfYear 
			yearNumber: yearExpiration asNumber 
			monthNumber: monthExpiration asNumber)}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	ticket _ self requestToHandlers: requestDictionary.
	
	ticketAsJson _ self serializeTicket: ticket.
	aRequest send200Response: ticketAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:25' prior: 50990426!
removeFromCart: aRequest

	| bookISBN bookQuantity cartId argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	bookISBN _ aRequest fields at: 'bookISBN'.
	bookQuantity _ aRequest fields at: 'bookQuantity'.
	"requestsQueue remove: bookQuantity asNumber of: bookISBN toCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #remove:of:toCartIdentifiedAs: .
	argArray _ {bookQuantity asNumber . bookISBN . cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	self requestToHandlers: requestDictionary.
	
	aRequest send200Response: 'OK'.

	! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:25' prior: 50990322!
createCart: aRequest

	| cartId cartIdAsJson clientId password argArray requestDictionary messageSymbol |
	clientId _ aRequest fields at: 'clientId'.
	password _ aRequest fields at: 'password'.
	"cartId _ requestsQueue createCartFor: clientId authenticatedWith: password."
	
	messageSymbol _ #createCartFor:authenticatedWith:.
	argArray _ 
		{clientId . 
		password }.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	cartId _ self requestToHandlers: requestDictionary.
	
	cartIdAsJson _ WebUtils jsonEncode: (cartId asString).
	aRequest send200Response: cartIdAsJson.! !
!TusLibrosServerQueueingInterface methodsFor: 'as yet unclassified' stamp: 'LNB 11/28/2021 19:57:25' prior: 50990364!
listCart: aRequest

	| cartId cartContents contentsAsJson argArray requestDictionary messageSymbol |
	cartId _ aRequest fields at: 'cartId'.
	"cartContents _ requestsQueue listCartIdentifiedAs: cartId asNumber."
	
	messageSymbol _ #listCartIdentifiedAs: .
	argArray _ {cartId asNumber}.
	
	requestDictionary _ 
	self createRequestDictionaryFor: messageSymbol andArgumentsIn: argArray.
			
	cartContents _ self requestToHandlers: requestDictionary.
	
	contentsAsJson _ WebUtils jsonEncode: cartContents contents.
	aRequest send200Response: contentsAsJson.! !

!methodRemoval: TusLibrosServerQueueingInterface #createRequestDictionaryFor:andArgumentIn: stamp: 'LNB 11/28/2021 19:57:25'!
createRequestDictionaryFor: aMessageSymbol andArgumentIn: anArgArray

	^ Dictionary 
		newFromPairs: {
			'message'. aMessageSymbol . 
			'args'. anArgArray.
			}!
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 19:59:55' prior: 50989237!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queuerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | [self createCart: request ] fork ].
	self addService: '/listCatalog' action: [ :request | [self listCatalog: request ] fork ].
	self addService: '/addToCart' action: [ :request | [self addToCart: request ] fork ].
	self addService: '/removeFromCart' action: [ :request | [self removeFromCart: request ] fork ].
	self addService: '/listCart' action: [ :request | [self listCart: request ] fork ].
	self addService: '/checkoutCart' action: [ :request | [self checkoutCart: request ] fork ].
	self addService: '/listPurchases' action: [ :request | [self listPurchases: request ] fork ].
	! !

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 20:02:55' prior: 50990543!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: privateResponseQueue.
	handlersSemaphore signal.
	
	response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

self getFields !

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 20:11:57' prior: 50991010!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queuerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | [self createCart: request ] value ].
	self addService: '/listCatalog' action: [ :request | [self listCatalog: request ] value ].
	self addService: '/addToCart' action: [ :request | [self addToCart: request ] value ].
	self addService: '/removeFromCart' action: [ :request | [self removeFromCart: request ] value ].
	self addService: '/listCart' action: [ :request | [self listCart: request ] value ].
	self addService: '/checkoutCart' action: [ :request | [self checkoutCart: request ] value ].
	self addService: '/listPurchases' action: [ :request | [self listPurchases: request ] value ].
	! !

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 20:17:46' prior: 50991058!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: privateResponseQueue.
	handlersSemaphore signal.
	
	[response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').]
		on: Error
		do: [].
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 20:18:45' prior: 50991137!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: privateResponseQueue.
	handlersSemaphore signal.
	
	[response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').]
		on: Error
		do: [:anError | privateResponseQueue nextPut: anError].
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 20:19:44' prior: 50991093!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queuerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | self createCart: request ].
	self addService: '/listCatalog' action: [ :request | self listCatalog: request ].
	self addService: '/addToCart' action: [ :request | self addToCart: request ].
	self addService: '/removeFromCart' action: [ :request | self removeFromCart: request ].
	self addService: '/listCart' action: [ :request | self listCart: request ].
	self addService: '/checkoutCart' action: [ :request | self checkoutCart: request ].
	self addService: '/listPurchases' action: [ :request | self listPurchases: request ].
	! !

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 20:24:09' prior: 50991158!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: privateResponseQueue.
	handlersSemaphore signal.
	
	self halt.
	
	[response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').]
		on: Error
		do: [:anError | privateResponseQueue nextPut: anError].
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

asynchronousServer _ TusLibrosAsynchronousServer new.!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

[asynchronousServer _ TusLibrosAsynchronousServer new.] fork!

asynchronousServer forkNewRequestHandler.!

TusLibrosClientMainWindow open!

TusLibrosAsynchronousServer allInstances do: [ :aServer | aServer destroy ].!

Utilities garbageCollectAndReport!

TusLibrosAsynchronousServer allInstances.!

----QUIT----(28 November 2021 20:34:31) CuisUniversity-4972.image priorSource: 21092827!

----STARTUP---- (28 November 2021 20:35:53) as E:\Cursada Actual IS1\Ejercicios para entregar\20-TusLibros\Iteracion4\CuisUniversity-4972.image!


TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/28/2021 21:24:04' prior: 50987639!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'GET'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/27/2021 17:48:13' prior: 50991290!
addToCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/addToCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !
!TusLibrosClientInterface methodsFor: 'sending requests' stamp: 'LNB 11/27/2021 18:24:42' prior: 50987687!
removeFromCartRequest: aCartId for: aBookISBN of: anAmount

	| fieldDict resp |
	fieldDict _ Dictionary newFromPairs: { 'cartId'. aCartId. 'bookISBN'. aBookISBN. 'bookQuantity'. anAmount }.
	
	resp _ WebClient htmlSubmit: (self url, '/removeFromCart') fields: fieldDict method: 'POST'.
	
	resp isSuccess 
        		ifFalse:[^self error: resp content].! !

TusLibrosClientMainWindow open.!

TusLibrosClientMainWindow open.!
!TusLibrosServerQueueingInterface methodsFor: 'initialization' stamp: 'LNB 11/28/2021 21:45:14' prior: 50991180!
initializeWith: aPortNumber addingRequestsTo: aRequestsQueue gettingResponseQueuesFrom: aHandlerQueue withMutexSemaphore: waitForHandlerSemaphore
	
	requestsQueue := aRequestsQueue.
	handlersQueue _ aHandlerQueue.
	queuerSemaphore _ waitForHandlerSemaphore.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	self addService: '/createCart' action: [ :request | [self createCart: request] fork ].
	self addService: '/listCatalog' action: [ :request | [self listCatalog: request] fork ].
	self addService: '/addToCart' action: [ :request | [self addToCart: request] fork ].
	self addService: '/removeFromCart' action: [ :request | [self removeFromCart: request] fork ].
	self addService: '/listCart' action: [ :request | [self listCart: request] fork ].
	self addService: '/checkoutCart' action: [ :request | [self checkoutCart: request] fork ].
	self addService: '/listPurchases' action: [ :request | [self listPurchases: request] fork ].
	! !
!TusLibrosServerRequestHandler methodsFor: 'enable services' stamp: 'LNB 11/28/2021 21:46:26' prior: 50991217!
handleARequest

	| requestDictionary response |
	handlersSemaphore wait.
	requestDictionary _ requestsQueue next.
	handlersQueue nextPut: privateResponseQueue.
	handlersSemaphore signal.
	
	[response _ systemFacade perform: (requestDictionary at: 'message') withArguments: (requestDictionary at: 'args').]
		on: Error
		do: [:anError | privateResponseQueue nextPut: anError].
	privateResponseQueue nextPut: response.
	
	"systemFacade := aTusLibrosSystemFacade.
	
	requestsQueue _ aRequestsQueue.
	handlersQueue _ aHandlersQueue.
	handlersSemaphore _ aHandlersSemaphore."
	
	! !

----SNAPSHOT----(28 November 2021 21:48:32) CuisUniversity-4972.image priorSource: 21107876!

----QUIT----(28 November 2021 21:48:50) CuisUniversity-4972.image priorSource: 21111841!